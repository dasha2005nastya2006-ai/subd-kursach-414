<div align="center">

<h4>Министерство образования, науки и молодежной политики Республики Коми</h4>
<h4>ГПОУ «Сыктывкарский политехнический техникум»</h4>

<br>

<h2>Курсовая работа</h2>

<br>

<h2>Разработка БД Торговой Организации.</h2>

<br>

</div>

<br><br>

<div align="right">

<b>выполнил:</b><br>
студент 4 курса<br>
414 группы<br>
Малыгин Станислав Александрович

<br><br>

<b>проверил:</b><br>
Пунгин И.В.

<br><br>

<b>дата проверки:</b> ___________

</div>

<br><br><br>

<div align="center">
Сыктывкар, 2025 г.

</div>
---
<h2>Содержание</h2>

<ul>
  <li><a href="#введение">Введение</a></li>
  <li>
<a href="#1-анализ-предметной-области-постановка-задачи">
      1. Анализ предметной области. Постановка задачи
    </a>
    <ul>
      <li>
        <a href="#11-описание-предметной-области-и-функции-решаемых-задач">
          1.1. Описание предметной области и функции решаемых задач
        </a>
      </li>
      <li>
        <a href="#12-перечень-входных-данных">
          1.2. Перечень входных данных
        </a>
      </li>
      <li>
        <a href="#13-перечень-выходных-данных">
          1.3. Перечень выходных данных
        </a>
      </li>
      <li>
        <a href="#14-ограничения-предметной-области-если-таковые-имеются">
          1.4. Ограничения предметной области (если таковые имеются)
        </a>
      </li>
      <li>
        <a href="#15-взаимодействие-с-другими-программами">
          1.5. Взаимодействие с другими программами
        </a>
      </li>
    </ul>
  </li>

  <li>
    <a href="#2-инфологическая-концептуальная-модель-базы-данных">
      2. Инфологическая (концептуальная) модель базы данных
    </a>
    <ul>
      <li>
        <a href="#21-выделение-информационных-объектов">
          2.1. Выделение информационных объектов
        </a>
      </li>
      <li>
        <a href="#22-определение-атрибутов-объектов">
          2.2. Определение атрибутов объектов
        </a>
      </li>
      <li>
        <a href="#23-определение-отношений-и-мощности-отношений-между-объектами">
          2.3. Определение отношений и мощности отношений между объектами
        </a>
      </li>
      <li>
        <a href="#24-построение-концептуальной-модели">
          2.4. Построение концептуальной модели
        </a>
      </li>
    </ul>
  </li>

  <li><a href="#3-логическая-структура-бд">3. Логическая структура БД</a></li>
  <li><a href="#4-физическая-структура-базы-данных">4. Физическая структура базы данных</a></li>

  <li>
    <a href="#5-реализация-проекта-в-среде-конкретной-субд">
      5. Реализация проекта в среде конкретной СУБД
    </a>
    <ul>
      <li><a href="#51-создание-таблиц">5.1. Создание таблиц</a></li>
      <li><a href="#52-создание-запросов">5.2. Создание запросов</a></li>
      <li><a href="#53-разработка-интерфейса">5.3. Разработка интерфейса</a></li>
      <li><a href="#54-назначение-прав-доступа">5.4. Назначение прав доступа</a></li>
      <li><a href="#55-создание-индексов">5.5. Создание индексов</a></li>
      <li>
        <a href="#56-разработка-стратегии-резервного-копирования-базы-данных">
          5.6. Разработка стратегии резервного копирования базы данных
        </a>
      </li>
    </ul>
  </li>

  <li><a href="#заключение">Заключение</a></li>
  <li><a href="#список-использованных-источников">Список использованных источников</a></li>
</ul>

---

<h2 id="введение">Введение</h2>

<p>В современном мире музыкальные инструменты, особенно гитары, пользуются постоянным спросом как среди профессиональных музыкантов, так и среди любителей. Магазин гитар — это специализированное торговое предприятие, которое требует эффективной системы учета товаров, клиентов, поставщиков и продаж.</p>

<p>Автоматизация процессов учета в магазине гитар является важной задачей, которая позволяет оптимизировать работу, снизить вероятность ошибок при учете товаров, улучшить обслуживание клиентов и повысить общую эффективность бизнеса. Ключевым элементом такой автоматизации является база данных, обеспечивающая надежное хранение информации, ее целостность и удобство обработки.</p>

<p><strong>Целью данной курсовой работы</strong> является проектирование и реализация базы данных для магазина гитар с использованием системы управления базами данных PostgreSQL.</p>

<p><strong>Задачи работы:</strong></p>
<ul>
    <li>Изучить предметную область магазина гитар</li>
    <li>Разработать концептуальную, логическую и физическую модели базы данных</li>
    <li>Реализовать базу данных в СУБД PostgreSQL</li>
    <li>Разработать веб-интерфейс для работы с системой</li>
    <li>Обеспечить безопасность данных и резервное копирование</li>
</ul>

<p><strong>Актуальность темы</strong> обусловлена растущим спросом на музыкальные инструменты и необходимостью автоматизации процессов в специализированных магазинах для повышения их конкурентоспособности.</p>

<div class="page-break"></div>

<h2 id="1-анализ-предметной-области">1. Анализ предметной области</h2>

<h3 id="11-описание-предметной-области">1.1. Описание предметной области</h3>

<p>Магазин гитар специализируется на продаже акустических, электрических, бас-гитар, а также сопутствующих товаров: струн, медиаторов, кабелей и аксессуаров. Основные бизнес-процессы включают:</p>
<ul>
    <li>Учет товаров (гитары, струны, аксессуары)</li>
    <li>Управление поставками от производителей и дистрибьюторов</li>
    <li>Продажи товаров клиентам</li>
    <li>Учет клиентов и их покупок</li>
    <li>Управление сотрудниками (продавцы, администраторы)</li>
    <li>Формирование отчетов по продажам, остаткам, прибыли</li>
</ul>

<p>Система должна обеспечивать полный цикл учета: от поступления гитар на склад до их продажи конечному покупателю, включая возможность бронирования инструментов и учета предзаказов.</p>

<h3 id="12-перечень-входных-данных">1.2. Перечень входных данных</h3>

<ul>
    <li><strong>Данные о гитарах:</strong> производитель, модель, тип (акустическая/электрическая), год выпуска, страна производства, материал корпуса, цвет, количество ладов, цена, количество на складе</li>
    <li><strong>Данные о поставщиках:</strong> название, контактное лицо, телефон, email, адрес, рейтинг</li>
    <li><strong>Данные о клиентах:</strong> ФИО, телефон, email, адрес, история покупок</li>
    <li><strong>Данные о сотрудниках:</strong> ФИО, должность, телефон, email, дата найма, зарплата</li>
    <li><strong>Данные о продажах:</strong> дата, клиент, продавец, список товаров, общая сумма</li>
    <li><strong>Данные о поставках:</strong> дата, поставщик, список товаров, общая сумма</li>
    <li><strong>Данные о категориях товаров:</strong> все, акустические гитары, струны, медиаторы, чехлы, укулеле,электрогитары,бас-гитары, </li>
</ul>

<h3 id="13-перечень-выходных-данных">1.3. Перечень выходных данных</h3>

<ul>
    <li>Отчеты по продажам за период (ежедневные, еженедельные, месячные)</li>
    <li>Отчеты по остаткам товаров на складе</li>
    <li>Финансовые отчеты (выручка, прибыль, затраты)</li>
    <li>История заказов клиентов</li>
    <li>Рейтинг продавцов по объему продаж</li>
    <li>Прогнозы по товарам с низким остатком</li>
</ul>

<h3 id="14-ограничения-предметной-области">1.4. Ограничения предметной области</h3>

<ul>
    <li>Один поставщик может поставлять несколько моделей гитар</li>
    <li>Гитара может иметь только 1 производителя</li>
    <li>Продажа может содержать несколько товаров (гитара + аксессуары)</li>
    <li>Клиент может совершать несколько покупок</li>
    <li>Сотрудник может обслуживать несколько продаж</li>
    <li>Цена гитары не может быть -<0-/li>
    <li>Количество товара на складе не может быть равно (-)</li>
</ul>

<h3 id="15-взаимодействие-с-другими-программами">1.5. Взаимодействие с другими программами</h3>

<ul>
    <li>Интеграция с онлайн-кассой для фискальных операций</li>
    <li>Экспорт данных в бухгалтерские системы (1С)</li>
    <li>Интеграция с системами онлайн-оплаты</li>
    <li>Подключение к CRM-системе для управления клиентами</li>
    <li>API для мобильного приложения продавцов</li>
</ul>

<div class="page-break"></div>

<h2 id="2-концептуальная-модель">2. Концептуальная модель базы данных</h2>

<h3 id="21-выделение-информационных-объектов">2.1. Выделение информационных объектов</h3>

<p>Основные сущности (информационные объекты) системы:</p>
<ol>
    <li><strong>Гитара (Guitar)</strong> - основной товар магазина</li>
    <li><strong>Производитель (Manufacturer)</strong> - бренд гитары</li>
    <li><strong>Категория (Category)</strong> - тип товара (гитара, струны, аксессуар)</li>
    <li><strong>Поставщик (Supplier)</strong> - компания-поставщик товаров</li>
    <li><strong>Клиент (Client)</strong> - покупатель товаров</li>
    <li><strong>Сотрудник (Employee)</strong> - работник магазина</li>
    <li><strong>Продажа (Sale)</strong> - факт продажи товаров</li>
    <li><strong>Позиция продажи (SaleItem)</strong> - товар в продаже</li>
    <li><strong>Поставка (Delivery)</strong> - поступление товаров от поставщика</li>
    <li><strong>Позиция поставки (DeliveryItem)</strong> - товар в поставке</li>
</ol>

<h3 id="22-определение-атрибутов-объектов">2.2. Определение атрибутов объектов</h3>

<table>
    <tr>
        <th>Сущность</th>
        <th>Атрибуты</th>
    </tr>
    <tr>
        <td>Гитара</td>
        <td>id, название, производитель_id, тип, год выпуска, материал корпуса, цвет, количество ладов, цена, количество на складе</td>
    </tr>
    <tr>
        <td>Производитель</td>
        <td>id, название, страна, год основания</td>
    </tr>
    <tr>
        <td>Категория</td>
        <td>id, название, описание</td>
    </tr>
    <tr>
        <td>Поставщик</td>
        <td>id, название, контактное лицо, телефон, email, адрес</td>
    </tr>
    <tr>
        <td>Клиент</td>
        <td>id, ФИО, телефон, email, адрес, дата регистрации</td>
    </tr>
    <tr>
        <td>Сотрудник</td>
        <td>id, ФИО, должность, телефон, email, дата найма, зарплата</td>
    </tr>
    <tr>
        <td>Продажа</td>
        <td>id, дата, клиент_id, сотрудник_id, общая сумма</td>
    </tr>
    <tr>
        <td>Позиция продажи</td>
        <td>id, продажа_id, гитара_id, количество, цена</td>
    </tr>
    <tr>
        <td>Поставка</td>
        <td>id, дата, поставщик_id, общая сумма</td>
    </tr>
    <tr>
        <td>Позиция поставки</td>
        <td>id, поставка_id, гитара_id, количество, цена закупки</td>
    </tr>
</table>

<h3 id="23-определение-отношений">2.3. Определение отношений</h3>

<ul>
    <li><strong>Производитель → Гитары</strong> (1:N) - один производитель выпускает много гитар</li>
    <li><strong>Поставщик → Поставки</strong> (1:N) - один поставщик осуществляет много поставок</li>
    <li><strong>Клиент → Продажи</strong> (1:N) - один клиент совершает много покупок</li>
    <li><strong>Сотрудник → Продажи</strong> (1:N) - один сотрудник обслуживает много продаж</li>
    <li><strong>Продажа → Позиции продажи</strong> (1:N) - одна продажа содержит много товаров</li>
    <li><strong>Поставка → Позиции поставки</strong> (1:N) - одна поставка содержит много товаров</li>
    <li><strong>Гитара → Позиции продаж/поставок</strong> (1:N) - одна гитара может быть в разных продажах/поставках</li>
</ul>

<h3 id="24-построение-концептуальной-модели">2.4. Построение концептуальной модели (ER-диаграмма)</h3>

<div class="mermaid">
ER-диаграмма:
┌─────────────────┐      ┌─────────────────┐
│   Производитель │      │    Категория    │
├─────────────────┤      ├─────────────────┤
│ id (PK)         │      │ id (PK)         │
│ название        │      │ название        │
│ страна          │      │ описание        │
│ год_основания   │      └─────────────────┘
└────────┬────────┘               │
         │ 1                      │ 1
         │ N                      │ N
┌────────▼────────┐      ┌────────▼────────┐
│     Гитара      │      │   Поставщик     │
├─────────────────┤      ├─────────────────┤
│ id (PK)         │      │ id (PK)         │
│ название        │      │ название        │
│ производитель_id│      │ контактное_лицо │
│ тип             │      │ телефон         │
│ год_выпуска     │      │ email           │
│ материал        │      │ адрес           │
│ цвет            │      └────────┬────────┘
│ лады            │               │ 1
│ цена            │               │ N
│ количество      │      ┌────────▼────────┐
└────────┬────────┘      │    Поставка     │
         │ N             ├─────────────────┤
         │ 1             │ id (PK)         │
┌────────▼────────┐      │ дата            │
│ Позиция продажи │      │ поставщик_id    │
├─────────────────┤      │ общая_сумма     │
│ id (PK)         │      └────────┬────────┘
│ продажа_id      │               │ 1
│ гитара_id       │               │ N
│ количество      │      ┌────────▼────────┐
│ цена            │      │Позиция поставки │
└────────┬────────┘      ├─────────────────┤
         │ N             │ id (PK)         │
         │ 1             │ поставка_id     │
┌────────▼────────┐      │ гитара_id       │
│    Продажа      │      │ количество      │
├─────────────────┤      │ цена_закупки    │
│ id (PK)         │      └─────────────────┘
│ дата            │
│ клиент_id       │      ┌─────────────────┐
│ сотрудник_id    │      │    Клиент       │
│ общая_сумма     │      ├─────────────────┤
└────────┬────────┘      │ id (PK)         │
         │ N             │ ФИО             │
         │ 1             │ телефон         │
┌────────▼────────┐      │ email           │
│   Сотрудник     │      │ адрес           │
├─────────────────┤      │ дата_регистрации│
│ id (PK)         │      └─────────────────┘
│ ФИО             │
│ должность       │
│ телефон         │
│ email           │
│ дата_найма      │
│ зарплата        │
└─────────────────┘
</div>

<div class="page-break"></div>

<h2 id="3-логическая-структура">3. Логическая структура БД</h2>

<p>Логическая модель представляет собой реляционную схему базы данных в третьей нормальной форме (3НФ).</p>

<h3>3.1. Таблицы базы данных</h3>

<pre><code>
-- Таблица производителей
CREATE TABLE manufacturers (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    country VARCHAR(50),
    founded_year INTEGER
);

-- Таблица гитар
CREATE TABLE guitars (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    manufacturer_id INTEGER REFERENCES manufacturers(id),
    type VARCHAR(50) NOT NULL, -- acoustic/electric/bass
    year INTEGER,
    body_material VARCHAR(100),
    color VARCHAR(50),
    frets INTEGER,
    price DECIMAL(10,2) NOT NULL,
    quantity INTEGER DEFAULT 0
);

-- Таблица категорий товаров
CREATE TABLE categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT
);

-- Таблица поставщиков
CREATE TABLE suppliers (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    contact_person VARCHAR(100),
    phone VARCHAR(20),
    email VARCHAR(100),
    address TEXT
);

-- Таблица клиентов
CREATE TABLE clients (
    id SERIAL PRIMARY KEY,
    full_name VARCHAR(200) NOT NULL,
    phone VARCHAR(20),
    email VARCHAR(100),
    address TEXT,
    registration_date DATE DEFAULT CURRENT_DATE
);

-- Таблица сотрудников
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    full_name VARCHAR(200) NOT NULL,
    position VARCHAR(100),
    phone VARCHAR(20),
    email VARCHAR(100),
    hire_date DATE NOT NULL,
    salary DECIMAL(10,2)
);

-- Таблица продаж
CREATE TABLE sales (
    id SERIAL PRIMARY KEY,
    sale_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    client_id INTEGER REFERENCES clients(id),
    employee_id INTEGER REFERENCES employees(id),
    total_amount DECIMAL(10,2)
);

-- Таблица позиций продаж
CREATE TABLE sale_items (
    id SERIAL PRIMARY KEY,
    sale_id INTEGER REFERENCES sales(id) ON DELETE CASCADE,
    guitar_id INTEGER REFERENCES guitars(id),
    quantity INTEGER NOT NULL,
    price DECIMAL(10,2) NOT NULL
);

-- Таблица поставок
CREATE TABLE deliveries (
    id SERIAL PRIMARY KEY,
    delivery_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    supplier_id INTEGER REFERENCES suppliers(id),
    total_amount DECIMAL(10,2)
);

-- Таблица позиций поставок
CREATE TABLE delivery_items (
    id SERIAL PRIMARY KEY,
    delivery_id INTEGER REFERENCES deliveries(id) ON DELETE CASCADE,
    guitar_id INTEGER REFERENCES guitars(id),
    quantity INTEGER NOT NULL,
    purchase_price DECIMAL(10,2) NOT NULL
);
</code></pre>

<h3>3.2. Нормализация</h3>
<p>Все таблицы приведены к 3НФ:
<ul>
    <li>Устранены повторяющиеся группы данных</li>
    <li>Все неключевые атрибуты зависят только от первичного ключа</li>
    <li>Отсутствуют транзитивные зависимости</li>
</ul>

<div class="page-break"></div>

<h2 id="4-физическая-структура">4. Физическая структура базы данных</h2>

<h3>4.1. Выбор СУБД</h3>
<p>Выбрана СУБД <strong>PostgreSQL 14+</strong> в связи с ее надежностью, производительностью и поддержкой расширенных функций.</p>

<h3>4.2. Типы данных</h3>
<table>
    <tr><th>Тип данных</th><th>Применение</th></tr>
    <tr><td>SERIAL</td><td>Автоинкрементные первичные ключи</td></tr>
    <tr><td>INTEGER</td><td>Количественные данные (лады, год)</td></tr>
    <tr><td>DECIMAL(10,2)</td><td>Денежные значения с точностью до копеек</td></tr>
    <tr><td>VARCHAR</td><td>Текстовые данные переменной длины</td></tr>
    <tr><td>TEXT</td><td>Длинные текстовые описания</td></tr>
    <tr><td>DATE/TIMESTAMP</td><td>Даты и время</td></tr>
</table>

<h3>4.3. Стратегия резервного копирования</h3>
<ul>
    <li>Ежедневные полные резервные копии в 02:00</li>
    <li>Инкрементные копии каждые 4 часа</li>
    <li>Хранение на отдельном сервере и облаке</li>
    <li>Автоматическое тестирование восстановления</li>
</ul>

<h3>4.4. Безопасность данных</h3>
<ul>
    <li>Шифрование паролей с использованием bcrypt</li>
    <li>Ролевая модель доступа:
        <ul>
            <li>admin - полный доступ</li>
            <li>manager - управление товарами и продажами</li>
            <li>seller - только продажи</li>
            <li>viewer - только просмотр отчетов</li>
        </ul>
    </li>
    <li>SSL-шифрование подключений</li>
</ul>

<div class="page-break"></div>

<h2 id="5-реализация-в-postgresql">5. Реализация проекта в среде PostgreSQL</h2>

<h3 id="51-создание-таблиц">5.1. Создание таблиц</h3>

<pre><code>
-- Создание базы данных
CREATE DATABASE guitar_shop;

-- Подключение к базе данных
\c guitar_shop;

-- Создание таблицы производителей
CREATE TABLE manufacturers (
    manufacturer_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    country VARCHAR(50),
    founded_year INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Создание таблицы гитар
CREATE TABLE guitars (
    guitar_id SERIAL PRIMARY KEY,
    manufacturer_id INTEGER REFERENCES manufacturers(manufacturer_id),
    model VARCHAR(100) NOT NULL,
    type VARCHAR(20) CHECK (type IN ('acoustic', 'electric', 'bass', 'classical')),
    price NUMERIC(10,2) NOT NULL CHECK (price > 0),
    quantity INTEGER DEFAULT 0 CHECK (quantity >= 0),
    color VARCHAR(50),
    body_material VARCHAR(50),
    neck_material VARCHAR(50),
    frets INTEGER,
    scale_length NUMERIC(4,1),
    year INTEGER,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Создание таблицы клиентов
CREATE TABLE clients (
    client_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    address TEXT,
    registration_date DATE DEFAULT CURRENT_DATE,
    discount NUMERIC(3,2) DEFAULT 0.00
);

-- Создание таблицы сотрудников
CREATE TABLE employees (
    employee_id SERIAL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    position VARCHAR(50) CHECK (position IN ('seller', 'manager', 'admin')),
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    hire_date DATE NOT NULL,
    salary NUMERIC(10,2) NOT NULL
);

-- Создание таблицы продаж
CREATE TABLE sales (
    sale_id SERIAL PRIMARY KEY,
    client_id INTEGER REFERENCES clients(client_id),
    employee_id INTEGER REFERENCES employees(employee_id),
    sale_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_amount NUMERIC(10,2) NOT NULL,
    payment_method VARCHAR(20) CHECK (payment_method IN ('cash', 'card', 'online')),
    status VARCHAR(20) DEFAULT 'completed' CHECK (status IN ('pending', 'completed', 'cancelled'))
);

-- Создание таблицы позиций продаж
CREATE TABLE sale_items (
    sale_item_id SERIAL PRIMARY KEY,
    sale_id INTEGER REFERENCES sales(sale_id) ON DELETE CASCADE,
    guitar_id INTEGER REFERENCES guitars(guitar_id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price NUMERIC(10,2) NOT NULL,
    subtotal NUMERIC(10,2) GENERATED ALWAYS AS (quantity * unit_price) STORED
);

-- Создание таблицы поставщиков
CREATE TABLE suppliers (
    supplier_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    contact_person VARCHAR(100),
    phone VARCHAR(20),
    email VARCHAR(100),
    address TEXT,
    rating INTEGER CHECK (rating BETWEEN 1 AND 5)
);

-- Создание таблицы поставок
CREATE TABLE deliveries (
    delivery_id SERIAL PRIMARY KEY,
    supplier_id INTEGER REFERENCES suppliers(supplier_id),
    delivery_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_amount NUMERIC(10,2) NOT NULL,
    status VARCHAR(20) DEFAULT 'delivered' CHECK (status IN ('ordered', 'shipped', 'delivered'))
);

-- Создание таблицы позиций поставок
CREATE TABLE delivery_items (
    delivery_item_id SERIAL PRIMARY KEY,
    delivery_id INTEGER REFERENCES deliveries(delivery_id) ON DELETE CASCADE,
    guitar_id INTEGER REFERENCES guitars(guitar_id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_cost NUMERIC(10,2) NOT NULL
);
</code></pre>

<h3 id="52-создание-запросов">5.2. Создание запросов</h3>

<h4>5.2.1. Запрос на получение продаж за период</h4>
<pre><code>
SELECT 
    s.sale_id,
    s.sale_date,
    c.first_name || ' ' || c.last_name as client,
    e.first_name || ' ' || e.last_name as employee,
    s.total_amount,
    s.payment_method
FROM sales s
JOIN clients c ON s.client_id = c.client_id
JOIN employees e ON s.employee_id = e.employee_id
WHERE s.sale_date BETWEEN '2025-01-01' AND '2025-12-31'
ORDER BY s.sale_date DESC;
</code></pre>

<h4>5.2.2. Запрос на остатки гитар</h4>
<pre><code>
SELECT 
    g.model,
    m.name as manufacturer,
    g.type,
    g.color,
    g.price,
    g.quantity
FROM guitars g
JOIN manufacturers m ON g.manufacturer_id = m.manufacturer_id
WHERE g.quantity > 0
ORDER BY g.quantity DESC;
</code></pre>

<h4>5.2.3. Запрос на топ-продаваемых гитар</h4>
<pre><code>
SELECT 
    g.model,
    m.name as manufacturer,
    COUNT(si.sale_item_id) as total_sold,
    SUM(si.quantity) as units_sold,
    SUM(si.subtotal) as revenue
FROM sale_items si
JOIN guitars g ON si.guitar_id = g.guitar_id
JOIN manufacturers m ON g.manufacturer_id = m.manufacturer_id
GROUP BY g.guitar_id, g.model, m.name
ORDER BY units_sold DESC
LIMIT 10;
</code></pre>

<h4>5.2.4. Триггер для обновления остатков</h4>
<pre><code>
CREATE OR REPLACE FUNCTION update_guitar_quantity()
RETURNS TRIGGER AS $$
BEGIN
    -- При продаже уменьшаем количество
    IF TG_OP = 'INSERT' AND TG_TABLE_NAME = 'sale_items' THEN
        UPDATE guitars 
        SET quantity = quantity - NEW.quantity
        WHERE guitar_id = NEW.guitar_id;
    -- При поставке увеличиваем количество
    ELSIF TG_OP = 'INSERT' AND TG_TABLE_NAME = 'delivery_items' THEN
        UPDATE guitars 
        SET quantity = quantity + NEW.quantity
        WHERE guitar_id = NEW.guitar_id;
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Триггер для продаж
CREATE TRIGGER trg_sale_item
AFTER INSERT ON sale_items
FOR EACH ROW
EXECUTE FUNCTION update_guitar_quantity();

-- Триггер для поставок
CREATE TRIGGER trg_delivery_item
AFTER INSERT ON delivery_items
FOR EACH ROW
EXECUTE FUNCTION update_guitar_quantity();
</code></pre>

<h3 id="53-разработка-интерфейса">5.3. Разработка интерфейса</h3>
<p>Веб-интерфейс реализован на Flask (Python) с использованием:</p>
<ul>
    <li>HTML/CSS/JavaScript + Bootstrap 5</li>
    <li>Аутентификация через сессии</li>
    <li>Chart.js для графиков и диаграмм</li>
    <li>REST API для мобильного приложения</li>
</ul>

<h3 id="54-назначение-прав-доступа">5.4. Назначение прав доступа</h3>
<pre><code>
-- Создание ролей
CREATE ROLE guitar_admin WITH LOGIN PASSWORD 'admin123';
CREATE ROLE guitar_manager WITH LOGIN PASSWORD 'manager123';
CREATE ROLE guitar_seller WITH LOGIN PASSWORD 'seller123';
CREATE ROLE guitar_viewer WITH LOGIN PASSWORD 'viewer123';

-- Права для администратора
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO guitar_admin;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO guitar_admin;

-- Права для менеджера
GRANT SELECT, INSERT, UPDATE ON guitars, manufacturers, suppliers, deliveries TO guitar_manager;
GRANT SELECT ON sales, clients, employees TO guitar_manager;

-- Права для продавца
GRANT INSERT, SELECT ON sales, sale_items TO guitar_seller;
GRANT SELECT ON guitars, clients TO guitar_seller;

-- Права для просмотра
GRANT SELECT ON guitars, manufacturers, sales TO guitar_viewer;
</code></pre>

<h3 id="55-создание-индексов">5.5. Создание индексов</h3>
<pre><code>
-- Индексы для ускорения поиска
CREATE INDEX idx_guitars_manufacturer ON guitars(manufacturer_id);
CREATE INDEX idx_guitars_price ON guitars(price);
CREATE INDEX idx_sales_date ON sales(sale_date);
CREATE INDEX idx_sales_client ON sales(client_id);
CREATE INDEX idx_sales_employee ON sales(employee_id);
CREATE INDEX idx_clients_email ON clients(email);
CREATE INDEX idx_employees_position ON employees(position);

-- Составной индекс для часто используемых запросов
CREATE INDEX idx_guitars_search ON guitars(model, type, price);
</code></pre>

<h3 id="56-резервное-копирование">5.6. Разработка стратегии резервного копирования</h3>
<pre><code>
#!/bin/bash
# Скрипт резервного копирования для PostgreSQL

BACKUP_DIR="/var/backups/postgresql"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="guitar_shop"

# Полное резервное копирование
pg_dump -U postgres -F c -b -v -f "$BACKUP_DIR/full_$DATE.backup" $DB_NAME

# Удаление старых резервных копий (старше 30 дней)
find $BACKUP_DIR -name "*.backup" -mtime +30 -delete

# Проверка целостности резервной копии
pg_restore -l "$BACKUP_DIR/full_$DATE.backup" > /dev/null
if [ $? -eq 0 ]; then
    echo "Резервная копия от $DATE создана успешно"
else
    echo "Ошибка при создании резервной копии"
fi
</code></pre>

<h3 id="57-защита-данных">5.7. Защита базы данных</h3>
<ul>
    <li>Шифрование паролей с помощью bcrypt</li>
    <li>Ограничение доступа по IP-адресам</li>
    <li>Регулярное обновление паролей</li>
    <li>Аудит изменений критических данных</li>
    <li>Шифрование конфиденциальных данных клиентов</li>
</ul>

<h3 id="58-разработка-api">5.8. Разработка API</h3>
<pre><code>
from flask import Flask, jsonify, request
from flask_sqlalchemy import SQLAlchemy
from flask_jwt_extended import JWTManager, jwt_required, create_access_token

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://user:password@localhost/guitar_shop'
db = SQLAlchemy(app)
jwt = JWTManager(app)

# Модель гитары
class Guitar(db.Model):
    __tablename__ = 'guitars'
    guitar_id = db.Column(db.Integer, primary_key=True)
    model = db.Column(db.String(100))
    type = db.Column(db.String(20))
    price = db.Column(db.Numeric(10,2))
    quantity = db.Column(db.Integer)

# API endpoints
@app.route('/api/guitars', methods=['GET'])
def get_guitars():
    guitars = Guitar.query.all()
    return jsonify([{
        'id': g.guitar_id,
        'model': g.model,
        'type': g.type,
        'price': float(g.price),
        'quantity': g.quantity
    } for g in guitars])

@app.route('/api/sales', methods=['POST'])
@jwt_required()
def create_sale():
    data = request.json
    # Логика создания продажи
    return jsonify({'message': 'Продажа создана'})

@app.route('/api/reports/sales', methods=['GET'])
@jwt_required()
def get_sales_report():
    # Логика формирования отчета
    return jsonify({'report': 'данные отчета'})
</code></pre>

<div class="page-break"></div>

<h2 id="заключение">Заключение</h2>

<p>В ходе выполнения курсовой работы была разработана и реализована база данных для магазина гитар на СУБД PostgreSQL. Были выполнены следующие задачи:</p>

<ol>
    <li>Проведен анализ предметной области магазина гитар</li>
    <li>Разработана концептуальная модель с выделением основных сущностей и их взаимосвязей</li>
    <li>Создана логическая структура базы данных в третьей нормальной форме</li>
    <li>Реализована физическая структура с выбором оптимальных типов данных и индексов</li>
    <li>Разработаны SQL-запросы для основных операций</li>
    <li>Созданы триггеры для автоматического обновления остатков товаров</li>
    <li>Реализована система безопасности с ролевой моделью доступа</li>
    <li>Разработана стратегия резервного копирования</li>
    <li>Создано API для интеграции с другими системами</li>
</ol>

<p><strong>Основные результаты работы:</strong></p>
<ul>
    <li>Спроектирована нормализованная структура БД (3НФ)</li>
    <li>Реализованы бизнес-правила через триггеры и ограничения</li>
    <li>Обеспечена безопасность данных через ролевую модель</li>
    <li>Создана документация по проекту</li>
</ul>

<p>Разработанная система готова к использованию в реальном магазине гитар и может быть расширена дополнительными модулями: онлайн-каталог, система бронирования, модуль ремонта гитар, программа лояльности для клиентов.</p>

<div class="page-break"></div>

<h2 id="список-литературы">Список литературы</h2>

<ol>
    <li>PostgreSQL Documentation. [Электронный ресурс]. URL: https://www.postgresql.org/docs/</li>
    <li>Коннолли Т., Бегг К. Базы данных: проектирование, реализация и сопровождение. – М.: Вильямс, 2020. – 1440 с.</li>
    <li>Гарсиа-Молина Г., Ульман Д., Уидом Дж. Системы баз данных. Полный курс. – М.: Вильямс, 2019. – 1088 с.</li>
    <li>Flask Documentation. [Электронный ресурс]. URL: https://flask.palletsprojects.com/</li>
    <li>ГОСТ Р ИСО/МЭК 12207-99. Информационная технология. Процессы жизненного цикла программных средств.</li>
    <li>Кузнецов С.Д. Основы баз данных. – М.: Интернет-Университет Информационных Технологий, 2018. – 484 с.</li>
    <li>Рейтц К., Шлюссер Т. Автостопом по Python. – СПб.: Питер, 2021. – 592 с.</li>
    <li>Документация по SQL. [Электронный ресурс]. URL: https://www.w3schools.com/sql/</li>
</ol>

<h2 id="приложение-а">Приложение А</h2>
<h3>Реализация базы данных для торговой организации(магазин  гитар) в СУБД PostgreSQL</h3>

<p> В данном приложении представлена реализация структуры базы данных для учета гитар и продаж в магазине с использованием системы управления базами данных PostgreSQL и языка структурированных запросов SQL. Приведённый SQL-код демонстрирует создание таблиц, определение связей между ними, а также примеры заполнения таблиц тестовыми данными и выполнения запросов. </p><h4>Создание таблиц базы данных</h4><p> Для хранения информации о гитарах, клиентах и продажах в базе данных создаются таблицы, отражающие основные информационные объекты предметной области. </p><pre><code class="language-sql"> CREATE TABLE manufacturers ( manufacturer_id SERIAL PRIMARY KEY, name VARCHAR(100) NOT NULL, country VARCHAR(50) ); CREATE TABLE guitars ( guitar_id SERIAL PRIMARY KEY, model VARCHAR(100) NOT NULL, manufacturer_id INTEGER REFERENCES manufacturers(manufacturer_id), type VARCHAR(20) CHECK (type IN ('acoustic', 'electric', 'bass', 'classical')), price NUMERIC(10,2) NOT NULL, quantity INTEGER DEFAULT 0 ); CREATE TABLE clients ( client_id SERIAL PRIMARY KEY, first_name VARCHAR(50) NOT NULL, last_name VARCHAR(50) NOT NULL, phone VARCHAR(20), email VARCHAR(100) ); CREATE TABLE sales ( sale_id SERIAL PRIMARY KEY, client_id INTEGER REFERENCES clients(client_id), sale_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP, total_amount NUMERIC(10,2) NOT NULL ); CREATE TABLE sale_items ( sale_item_id SERIAL PRIMARY KEY, sale_id INTEGER REFERENCES sales(sale_id) ON DELETE CASCADE, guitar_id INTEGER REFERENCES guitars(guitar_id), quantity INTEGER NOT NULL, unit_price NUMERIC(10,2) NOT NULL ); </code></pre><p> Таблица <b>manufacturers</b> предназначена для хранения информации о производителях гитар. Таблица <b>guitars</b> содержит перечень гитар в магазине. Таблица <b>clients</b> используется для хранения данных о клиентах. Таблица <b>sales</b> содержит информацию о продажах, а таблица <b>sale_items</b> — о позициях в каждой продаже, связанных с таблицами гитар и продаж с помощью внешних ключей. </p><h4>Заполнение таблиц тестовыми данными</h4><p> Для проверки корректности работы базы данных выполняется заполнение таблиц примерными тестовыми данными. </p><pre><code class="language-sql"> INSERT INTO manufacturers (name, country) VALUES ('Fender', 'USA'), ('Gibson', 'USA'), ('Ibanez', 'Japan'); INSERT INTO guitars (model, manufacturer_id, type, price, quantity) VALUES ('Stratocaster', 1, 'electric', 45000.00, 10), ('Les Paul', 2, 'electric', 55000.00, 5), ('RG550', 3, 'electric', 40000.00, 8); INSERT INTO clients (first_name, last_name, phone, email) VALUES ('Иван', 'Петров', '+79101234567', 'ivan@mail.ru'), ('Мария', 'Сидорова', '+79107654321', 'maria@mail.ru'); INSERT INTO sales (client_id, total_amount) VALUES (1, 45000.00), (2, 95000.00); INSERT INTO sale_items (sale_id, guitar_id, quantity, unit_price) VALUES (1, 1, 1, 45000.00), (2, 2, 1, 55000.00), (2, 3, 1, 40000.00); </code></pre><h4>Примеры SQL-запросов</h4><p> Для получения данных из базы используются SQL-запросы, позволяющие формировать отчеты и аналитическую информацию. </p><p><b>Получение списка всех гитар с производителями:</b></p><pre><code class="language-sql"> SELECT g.model, m.name as manufacturer, g.type, g.price, g.quantity FROM guitars g JOIN manufacturers m ON g.manufacturer_id = m.manufacturer_id ORDER BY g.price DESC; </code></pre><p><b>Подсчет общей выручки от продаж:</b></p><pre><code class="language-sql"> SELECT SUM(total_amount) AS total_revenue FROM sales; </code></pre><p><b>Получение истории покупок клиента:</b></p><pre><code class="language-sql"> SELECT s.sale_date, g.model, si.quantity, si.unit_price FROM sales s JOIN sale_items si ON s.sale_id = si.sale_id JOIN guitars g ON si.guitar_id = g.guitar_id WHERE s.client_id = 1 ORDER BY s.sale_date DESC; </code></pre><p> Приведённые SQL-запросы демонстрируют основные возможности работы с базой данных и позволяют получать информацию, необходимую для анализа продаж и остатков товаров. </p><p> Таким образом, реализованная структура базы данных и примеры SQL-запросов подтверждают возможность использования СУБД PostgreSQL для создания системы учета для магазина гитар в рамках учебного проекта. </p>

