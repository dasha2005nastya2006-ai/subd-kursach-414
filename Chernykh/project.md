### <p align="center"> Министерство образования, науки и молодежной политики Республики Коми

### <p align="center"> ГПОУ «Сыктывкарский политехнический техникум»

## <p align="center"> Курсовая работа

## <p align="center"> тема: Разработка базы данных для центра по продаже автомобилей </p>

#### <p align="right"> выполнила

 <p align="right">студент 4 курса

<p align="right">414 группы

<p align="right">Черных Эльвира Николаевна

#### <p align="right">проверил

<p align="right">Пунгин И.В.

<p align="right">дата проверки:

<p align="center">Сыктывкар, 2025 г.

***

## Задание на курсовую работу по МДК 11.01 "Технология разработки и защиты баз данных"

Специальность: <ins> 09.02.07 "Информационные системы и программирование"  </ins>

Тема курсовой работы: Разработка базы данных для центра по продаже автомобилей

Срок представления работы к защите: <ins> 22 декабря 2025 года. </ins>

Перечень подлежащих разработке вопросов:

1. Анализ предметной области. Постановка задачи.

    1.1. Описание предметной области и функции решаемых задач.

    1.2. Перечень входных данных.

    1.3. Перечень выходных данных

    1.4. Ограничения предметной области (если таковые имеются).

    1.5. Взаимодействие с другими программами.

3. Инфологическая (концептуальная) модель базы данных.

    2.1. Выделение информационных объектов.

    2.2. Определение атрибутов объектов.

    2.3. Определение отношений и мощности отношений между объектами.

    2.4. Построение концептуальной модели.

4. Логическая структура БД.

5. Физическая структура базы данных.

6. Реализация проекта в среде конкретной СУБД.

    5.1. Создание таблиц.

    5.2. Создание запросов.

    5.3. Разработка интерфейса.

    5.4. Назначение прав доступа.

    5.5. Создание индексов.

    5.6. Разработка стратегии резервного копирования базы данных


Руководитель работы __________________ <ins> И. В. Пунгин </ins>

Задание принял к исполнению _______________________________ <ins> Черных Э.Н. </ins>



## <a id="content">Содержание</a>

1. [Введение](#introduction)
    - [Актуальность темы](#relevance)
    - [Цель работы](#target)
    - [Задачи работы](#tasks)
3. [Основная часть](#main)
    - [Анализ предметной области. Постановка задачи](#analysis)
    - [Инфологическая (концептуальная) модель базы данных](#infological_model)
    - [Логическая структура БД](#logical_structure)
    - [Физическая структура базы данных](#physical_structure)
    - [Реализация проекта в среде конкретной СУБД](#project_realization)
4. [Заключение](#conclusion)
5. [Список использованных информационных источников](#literature)
6. [Приложения](#applications)

## <a id="introduction">Введение</a>

### <a id="relevance">Актуальность темы</a>

В современных условиях высококонкурентного рынка продажа автомобилей требует эффективного управления большими объемами информации: данными об автомобилях, клиентах, поставщиках, сделках и сотрудниках. Автоматизация этих процессов с помощью специализированной базы данных (БД) является критически важной задачей для любого современного автомобильного центра. Такая система позволяет не только хранить информацию в структурированном виде, но и оперативно извлекать аналитические данные, оптимизировать складские запасы, управлять взаимоотношениями с клиентами (CRM) и контролировать финансовые потоки.

Разработка базы данных для центра по продаже автомобилей направлена на создание единого информационного пространства, которое объединит все аспекты бизнеса: от закупки автомобилей у поставщиков до заключения договоров купли-продажи с конечными покупателями. Внедрение БД позволит устранить дублирование данных, снизить количество ошибок при ручном вводе, ускорить обработку заявок и повысить общую эффективность работы центра.

Таким образом, актуальность данной курсовой работы обусловлена необходимостью создания надежного, масштабируемого и удобного инструмента для управления ключевыми бизнес-процессами автомобильного центра, что в конечном итоге ведет к повышению качества обслуживания клиентов и росту прибыли.

### <a id="target">Цель работы</a>

Целью данной курсовой работы является проектирование и реализация реляционной базы данных для центра по продаже автомобилей в среде СУБД PostgreSQL с использованием клиента pgAdmin 4. Данная БД должна обеспечивать комплексный учет всех бизнес-процессов, включая управление автомобильным парком, клиентской базой, заказами, поставщиками и сотрудниками.

### <a id="tasks">Задачи работы</a>

Для достижения поставленной цели необходимо решить следующие задачи:

1.  Провести анализ предметной области "Продажа автомобилей", выявить ключевые сущности, процессы и требования к системе.
2.  Спроектировать инфологическую (концептуальную) модель данных, отражающую сущности предметной области и связи между ними.
3.  Разработать логическую структуру базы данных, преобразовав концептуальную модель в реляционную схему (таблицы, атрибуты, типы данных, связи).
4.  Определить физическую структуру БД: выбрать типы данных, запланировать индексы, триггеры и ограничения целостности для СУБД PostgreSQL.
5.  Реализовать проект в pgAdmin 4:
    *   Создать схему базы данных и все необходимые таблицы.
    *   Написать и выполнить набор базовых SQL-запросов (SELECT, INSERT, UPDATE, DELETE) и аналитических запросов (JOIN, агрегатные функции).
    *   Создать необходимые индексы для оптимизации производительности.
    *   Разработать простой пользовательский интерфейс (например, набор представлений - VIEW) для удобства работы.
    *   Спроектировать и назначить роли и права доступа для различных пользователей (администратор, менеджер по продажам, кладовщик).
    *   Предложить стратегию резервного копирования базы данных.

## <a id="main">Основная часть</a>

### <a id="analysis">1. Анализ предметной области. Постановка задачи</a>

**1.1. Описание предметной области и функции решаемых задач**

*   **Предметная область:** Деятельность автомобильного дилерского центра, включающая закупку новых и подержанных автомобилей у поставщиков и производителей, их хранение на складе (автостоянке), продажу физическим и юридическим лицам, а также ведение учета клиентов, сделок и сотрудников.
*   **Функции решаемых задач:**
    *   **Учет автомобилей:** Ведение каталога автомобилей с детальными характеристиками (марка, модель, VIN, год выпуска, цвет, тип двигателя, комплектация), отслеживание их статуса (на складе, забронирован, продан, в сервисе).
    *   **Управление складом:** Контроль наличия автомобилей на стоянке, учет их местоположения, стоимость закупки и продажи.
    *   **Работа с клиентами:** Ведение базы данных клиентов (покупателей), история их обращений, тест-драйвов, покупок и предпочтений.
    *   **Оформление сделок:** Фиксация договоров купли-продажи, заказов на покупку, данных о платежах и способах оплаты.
    *   **Учет поставщиков:** Хранение информации о компаниях-поставщиках автомобилей.
    *   **Управление персоналом:** Учет сотрудников центра (менеджеры, администраторы), их ролей и прав доступа к системе.
    *   **Формирование отчетности:** Генерация отчетов по продажам, остаткам на складе, активности менеджеров, популярным моделям и т.д.

**1.2. Перечень входных данных**

*   Данные об автомобилях: VIN, марка, модель, год выпуска, цвет, пробег (для б/у), тип двигателя, объем двигателя, мощность, тип КПП, тип привода, комплектация, цена закупки, цена продажи, дата поступления, статус, ID поставщика.
*   Данные о клиентах: ФИО, тип (физ./юр. лицо), паспортные данные/реквизиты организации, контакты (телефон, email), адрес.
*   Данные о сделках: номер договора, дата сделки, ID автомобиля, ID клиента, ID менеджера, окончательная цена продажи, способ оплаты (наличные, кредит, лизинг), статус сделки (оформлена, оплачена, доставлена).
*   Данные о поставщиках: название, ИНН, юридический адрес, контактное лицо, телефон.
*   Данные о сотрудниках: ФИО, должность, контакты, логин и хэш пароля для системы.

**1.3. Перечень выходных данных (отчетов)**

*   Каталог доступных автомобилей с фильтрацией по параметрам.
*   Отчет о продажах за период (по менеджерам, по моделям, по сумме).
*   Отчет об остатках автомобилей на складе.
*   Отчет о финансовых результатах (прибыль = сумма продаж - сумма закупок).
*   История сделок конкретного клиента.
*   Рейтинг менеджеров по продажам.
*   Список автомобилей, ожидающих поставки от конкретного поставщика.

**1.4. Ограничения предметной области**

*   Один автомобиль за один момент времени может находиться только в одном статусе и быть связан только с одной активной сделкой.
*   Клиент (физ. лицо) идентифицируется уникальными паспортными данными.
*   Цена продажи в сделке не может быть ниже цены закупки автомобиля (для контроля рентабельности).
*   Автомобиль с статусом "Продан" не может быть повторно добавлен в новую сделку.

**1.5. Взаимодействие с другими программами**

*   **Экспорт и импорт данных в формате Excel:** Обмен данными о сделках, платежах и клиентах для ведения финансового учета.
*   **Графический пользовательский интерфейс на Python:** Обеспечение удобного доступа к данным для сотрудников.
*   **Веб-сайт центра:** Синхронизация каталога автомобилей (наличие, цены, характеристики) для отображения на сайте.
*   **Сервисная система:** Передача данных о проданных автомобилях для планирования сервисного обслуживания.

### <a id="infological_model">2. Инфологическая (концептуальная) модель базы данных</a>

**2.1. Выделение информационных объектов (сущностей)**

1.  `Автомобиль` - основная продаваемая единица.
2.  `Клиент` - покупатель автомобиля.
3.  `Сделка` - факт продажи автомобиля клиенту.
4.  `Поставщик` - организация, у которой центр закупает автомобили.
5.  `Сотрудник` - работник центра, в частности, менеджер по продажам.
6.  `Должность` - справочник должностей сотрудников (для управления правами).

**2.2. Определение атрибутов объектов**

*   **Автомобиль:** `car_id`, `vin` (уникальный), `brand`, `model`, `year`, `color`, `mileage`, `engine_type`, `engine_volume`, `power`, `transmission`, `drive_type`, `trim_level`, `purchase_price`, `sale_price`, `arrival_date`, `status` ('В наличии', 'Забронирован', 'Продан', 'На сервисе'), `supplier_id`.
*   **Клиент:** `client_id`, `last_name`, `first_name`, `middle_name`, `type` ('Физическое лицо', 'Юридическое лицо'), `passport_number` (для физ. лиц), `company_name` (для юр. лиц), `inn` (для юр. лиц), `phone`, `email`, `address`.
*   **Сделка:** `deal_id`, `deal_date`, `car_id`, `client_id`, `employee_id`, `final_price`, `payment_method` ('Наличные', 'Кредит', 'Лизинг'), `deal_status` ('Оформлена', 'Оплачена', 'Завершена').
*   **Поставщик:** `supplier_id`, `name`, `inn`, `legal_address`, `contact_person`, `phone`.
*   **Сотрудник:** `employee_id`, `last_name`, `first_name`, `middle_name`, `position_id`, `phone`, `email`, `login`, `password_hash`.
*   **Должность:** `position_id`, `position_name` (например, 'Администратор', 'Менеджер по продажам', 'Директор').

**2.3. Определение отношений и мощности отношений между объектами**

1.  **Поставщик — Автомобиль:** **Один ко многим (1:M)**. Один поставщик может поставить много автомобилей, но каждый автомобиль закуплен у одного конкретного поставщика.
2.  **Автомобиль — Сделка:** **Один к одному (1:1) / Один ко многим (1:M) в истории.** В один момент времени один автомобиль может фигурировать только в одной активной сделке (1:1). За всю историю с автомобилем может быть связана только одна успешная сделка о продаже, но могут быть записи о бронированиях (1:M).
3.  **Клиент — Сделка:** **Один ко многим (1:M).** Один клиент может совершить несколько сделок (покупок) в разное время.
4.  **Сотрудник — Сделка:** **Один ко многим (1:M).** Один сотрудник (менеджер) может оформить множество сделок.
5.  **Должность — Сотрудник:** **Один ко многим (1:M).** На одной должности может работать несколько сотрудников.

**2.4. Построение концептуальной модели**

![ER-диаграмма](diagram.jpg)


### <a id="logical_structure">3. Логическая структура БД</a>

Логическая модель преобразует концептуальную модель в схему реляционных таблиц. Все связи "один ко многим" реализуются через внешние ключи (FOREIGN KEY). Связь "один к одному" между `Автомобиль` и текущей `Сделкой` будет контролироваться бизнес-логикой и статусом автомобиля.

**Список таблиц:**

1.  `suppliers` (Поставщики)
2.  `cars` (Автомобили)
3.  `clients` (Клиенты)
4.  `employees` (Сотрудники)
5.  `positions` (Должности)
6.  `deals` (Сделки)

**Схема связей:**
*   `cars.supplier_id` -> `suppliers.supplier_id`
*   `deals.car_id` -> `cars.car_id`
*   `deals.client_id` -> `clients.client_id`
*   `deals.employee_id` -> `employees.employee_id`
*   `employees.position_id` -> `positions.position_id`

### <a id="physical_structure">4. Физическая структура базы данных</a>

Физическая структура определяет конкретную реализацию в PostgreSQL. Указываются точные типы данных, ограничения (CONSTRAINTS), значения по умолчанию.

**Выбор типов данных:**

*   `SERIAL` / `BIGSERIAL`: Для автоинкрементных первичных ключей (`id`).
*   `VARCHAR(n)`: Для строк переменной длины (имена, названия, email, VIN). Для VIN используется `VARCHAR(17)`.
*   `INTEGER`: Для целочисленных значений (год выпуска, мощность).
*   `NUMERIC(p, s)`: Для денежных сумм (`purchase_price`, `sale_price`, `final_price`). Например, `NUMERIC(12, 2)`.
*   `DATE`: Для дат (`arrival_date`, `deal_date`).
*   `BOOLEAN`: Для флагов (можно использовать вместо `status`, но `ENUM` или `VARCHAR` предпочтительнее для статусов).
*   `ENUM` или `VARCHAR`: Для полей с ограниченным набором значений (`status`, `type`, `payment_method`). В PostgreSQL удобно использовать тип `ENUM`, созданный отдельной командой.

**Индексы (планируемые):**

*   Первичные ключи (PRIMARY KEY) индексируются автоматически.
*   Индекс по `cars.vin` (UNIQUE) для быстрого поиска по VIN.
*   Индекс по `cars.status` для быстрой фильтрации автомобилей в наличии.
*   Индекс по `deals.deal_date` для ускорения формирования отчетов за период.
*   Индекс по `clients.phone` для быстрого поиска клиента.
*   Составные индексы для часто используемых запросов (например, `(brand, model, year)` в таблице `cars`).

### <a id="project_realization">5. Реализация проекта в среде конкретной СУБД</a>

Для реализации базы данных автомобильного центра была выбрана СУБД **PostgreSQL версии 15 и выше**, а также клиент для администрирования **pgAdmin 4**. PostgreSQL была выбрана благодаря следующим преимуществам:

- **Надежность и стабильность** — система обладает высокой отказоустойчивостью и поддержкой транзакций ACID
- **Расширенная функциональность** — поддержка пользовательских типов данных, триггеров, хранимых процедур, оконных функций
- **Бесплатная лицензия** — система распространяется под открытой лицензией PostgreSQL License
- **Хорошая документация и сообщество** — обширная документация и активное сообщество разработчиков
- **Поддержка JSON и пространственных данных** — возможность расширения функциональности в будущем

**5.1. Создание таблиц**

Для хранения данных автомобильного центра была разработана структура из 6 связанных таблиц:

**Основные таблицы базы данных:**

1. **Таблица `positions` (Должности)** — справочник должностей сотрудников
2. **Таблица `suppliers` (Поставщики)** — информация о компаниях-поставщиках автомобилей
3. **Таблица `employees` (Сотрудники)** — данные о персонале автомобильного центра
4. **Таблица `clients` (Клиенты)** — информация о покупателях (физических и юридических лицах)
5. **Таблица `cars` (Автомобили)** — каталог автомобилей с техническими характеристиками
6. **Таблица `deals` (Сделки)** — информация о заключенных сделках купли-продажи

**Особенности реализации таблиц:**

```sql
-- Создание пользовательских типов данных для обеспечения целостности
CREATE TYPE car_status_type AS ENUM ('В наличии', 'Забронирован', 'Продан', 'На сервисе');
CREATE TYPE client_type AS ENUM ('Физическое лицо', 'Юридическое лицо');
CREATE TYPE payment_method_type AS ENUM ('Наличные', 'Кредит', 'Лизинг');
CREATE TYPE deal_status_type AS ENUM ('Оформлена', 'Оплачена', 'Завершена');
```

**Ключевые ограничения целостности:**

- **Внешние ключи** для поддержания ссылочной целостности между таблицами
- **Проверочные ограничения (CHECK constraints)** для бизнес-логики
- **Уникальные ограничения** для предотвращения дублирования данных
- **Умолчательные значения** для полей дат и статусов

**Пример реализации таблицы `clients` с бизнес-ограничениями:**

```sql
CREATE TABLE clients (
    client_id SERIAL PRIMARY KEY,
    last_name VARCHAR(100),
    first_name VARCHAR(100),
    middle_name VARCHAR(100),
    type client_type NOT NULL,
    passport_number VARCHAR(20),
    company_name VARCHAR(200),
    inn VARCHAR(12) CHECK (inn IS NULL OR inn ~ '^[0-9]{10,12}$'),
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(100),
    address TEXT,
    -- Ограничение: для физ. лиц обязателен паспорт, для юр. лиц - название компании
    CONSTRAINT chk_client_type CHECK (
        (type = 'Физическое лицо' AND passport_number IS NOT NULL AND company_name IS NULL)
        OR
        (type = 'Юридическое лицо' AND company_name IS NOT NULL AND passport_number IS NULL)
    )
);
COMMENT ON TABLE clients IS 'Клиенты (покупатели)';
```

**5.2. Создание запросов**

Для обеспечения удобства работы с данными были разработаны SQL-запросы различной сложности:

**Базовые операционные запросы:**

```sql
-- 1. Поиск автомобилей по характеристикам
SELECT * FROM cars 
WHERE brand = 'LADA' 
    AND year >= 2023 
    AND status = 'В наличии'
ORDER BY sale_price;

-- 2. Поиск клиента по телефону
SELECT * FROM clients 
WHERE phone LIKE '%111-22-33%';

-- 3. Подсчет автомобилей по статусам
SELECT status, COUNT(*) as count 
FROM cars 
GROUP BY status 
ORDER BY count DESC;
```

**Аналитические запросы для отчетности:**

```sql
-- 4. Общая сумма продаж по менеджерам
SELECT 
    e.last_name || ' ' || e.first_name as manager,
    COUNT(d.deal_id) as deals_count,
    SUM(d.final_price) as total_sales
FROM employees e
LEFT JOIN deals d ON e.employee_id = d.employee_id
WHERE e.position_id = (SELECT position_id FROM positions WHERE position_name = 'Менеджер по продажам')
GROUP BY e.employee_id
ORDER BY total_sales DESC NULLS LAST;

-- 5. Автомобили с наценкой более 15%
SELECT 
    brand, model, year, vin,
    purchase_price,
    sale_price,
    ROUND((sale_price - purchase_price) / purchase_price * 100, 2) as markup_percent
FROM cars
WHERE sale_price IS NOT NULL 
    AND (sale_price - purchase_price) / purchase_price > 0.15
ORDER BY markup_percent DESC;

-- 6. Ежемесячная статистика продаж
SELECT 
    EXTRACT(YEAR FROM deal_date) as year,
    EXTRACT(MONTH FROM deal_date) as month,
    COUNT(*) as deals_count,
    SUM(final_price) as total_revenue,
    AVG(final_price) as avg_deal_price
FROM deals
GROUP BY EXTRACT(YEAR FROM deal_date), EXTRACT(MONTH FROM deal_date)
ORDER BY year DESC, month DESC;
```

**5.3. Разработка интерфейса**

В качестве интерфейса для работы с базой данных были созданы представления (VIEW), которые обеспечивают удобный доступ к часто используемым данным:

**1. Каталог доступных автомобилей**

```sql
CREATE OR REPLACE VIEW available_cars_view AS
SELECT 
    car_id,
    vin,
    brand,
    model,
    year,
    color,
    mileage,
    engine_type,
    engine_volume,
    power,
    transmission,
    drive_type,
    trim_level,
    sale_price,
    arrival_date
FROM cars
WHERE status = 'В наличии'
ORDER BY brand, model, year DESC;

COMMENT ON VIEW available_cars_view IS 'Каталог автомобилей в наличии';
```

**2. Отчет по продажам за текущий месяц**

```sql
CREATE OR REPLACE VIEW monthly_sales_report AS
SELECT 
    d.deal_id,
    d.deal_date,
    c.brand || ' ' || c.model as car_name,
    c.vin,
    cl.last_name || ' ' || cl.first_name as client_name,
    e.last_name || ' ' || e.first_name as manager_name,
    d.final_price,
    d.payment_method,
    d.deal_status
FROM deals d
JOIN cars c ON d.car_id = c.car_id
JOIN clients cl ON d.client_id = cl.client_id
JOIN employees e ON d.employee_id = e.employee_id
WHERE EXTRACT(YEAR FROM d.deal_date) = EXTRACT(YEAR FROM CURRENT_DATE)
    AND EXTRACT(MONTH FROM d.deal_date) = EXTRACT(MONTH FROM CURRENT_DATE)
ORDER BY d.deal_date DESC;

COMMENT ON VIEW monthly_sales_report IS 'Отчет по сделкам за текущий месяц';
```

**3. Финансовый отчет (прибыль по проданным автомобилям)**

```sql
CREATE OR REPLACE VIEW profit_report AS
SELECT 
    d.deal_id,
    d.deal_date,
    c.brand || ' ' || c.model as car_name,
    c.vin,
    c.purchase_price,
    d.final_price,
    (d.final_price - c.purchase_price) as profit,
    ROUND(((d.final_price - c.purchase_price) / c.purchase_price * 100), 2) as profit_percent
FROM deals d
JOIN cars c ON d.car_id = c.car_id
WHERE d.deal_status IN ('Оплачена', 'Завершена')
ORDER BY d.deal_date DESC;

COMMENT ON VIEW profit_report IS 'Финансовая прибыль по завершенным сделкам';
```

**Преимущества использования представлений:**

- **Абстракция сложных запросов** для конечных пользователей
- **Повышение безопасности** путем ограничения доступа к основным таблицам
- **Упрощение разработки** клиентских приложений
- **Возможность оптимизации** производительности

**5.4. Назначение прав доступа**

Для обеспечения безопасности данных была реализована ролевая модель доступа с тремя основными ролями:

**Создание ролей:**

```sql
-- Администратор (полный доступ)
CREATE ROLE car_admin WITH LOGIN PASSWORD 'admin123' SUPERUSER;

-- Менеджер по продажам (работа с клиентами и сделками)
CREATE ROLE car_manager WITH LOGIN PASSWORD 'manager123';

-- Кладовщик (учет автомобилей)
CREATE ROLE car_warehouse WITH LOGIN PASSWORD 'warehouse123';
```

**Назначение привилегий для менеджера по продажам:**

```sql
GRANT SELECT, INSERT, UPDATE ON 
    clients, deals, 
    available_cars_view, monthly_sales_report
TO car_manager;

GRANT SELECT ON 
    cars, employees, positions, suppliers,
    profit_report
TO car_manager;

GRANT USAGE ON SEQUENCE 
    clients_client_id_seq, deals_deal_id_seq
TO car_manager;
```

**Назначение привилегий для кладовщика:**

```sql
GRANT SELECT, INSERT, UPDATE ON 
    cars, suppliers
TO car_warehouse;

GRANT SELECT ON 
    positions, available_cars_view
TO car_warehouse;

GRANT USAGE ON SEQUENCE 
    cars_car_id_seq, suppliers_supplier_id_seq
TO car_warehouse;
```

**Принципы распределения прав:**

- **Минимальные необходимые привилегии** для каждой роли
- **Разделение обязанностей** между сотрудниками
- **Защита конфиденциальной информации** (паролей сотрудников, закупочных цен)
- **Обеспечение аудита** действий пользователей

**5.5. Создание индексов**

Для оптимизации производительности запросов были созданы индексы на часто используемых полях:

**Индексы для таблицы `cars`:**

```sql
CREATE INDEX idx_cars_vin ON cars(vin); -- Поиск по VIN-номеру
CREATE INDEX idx_cars_status ON cars(status); -- Фильтрация по статусу
CREATE INDEX idx_cars_brand_model_year ON cars(brand, model, year); -- Поиск по марке и модели
CREATE INDEX idx_cars_supplier ON cars(supplier_id); -- JOIN с поставщиками
```

**Индексы для таблицы `deals`:**

```sql
CREATE INDEX idx_deals_date ON deals(deal_date); -- Отчеты по датам
CREATE INDEX idx_deals_car ON deals(car_id); -- Поиск сделок по автомобилю
CREATE INDEX idx_deals_client ON deals(client_id); -- История покупок клиента
CREATE INDEX idx_deals_employee ON deals(employee_id); -- Продуктивность менеджеров
CREATE INDEX idx_deals_status ON deals(deal_status); -- Фильтрация по статусу сделки
```

**Индексы для таблицы `clients`:**

```sql
CREATE INDEX idx_clients_phone ON clients(phone); -- Быстрый поиск по телефону
CREATE INDEX idx_clients_type ON clients(type); -- Фильтрация по типу клиента
CREATE INDEX idx_clients_name ON clients(last_name, first_name); -- Поиск по ФИО
```

**Принципы создания индексов:**

- Индексы создаются на полях, используемых в условиях `WHERE`
- Составные индексы для часто используемых комбинаций полей
- Учет селективности полей при создании индексов
- Баланс между производительностью запросов и скоростью вставки данных

**5.6. Разработка стратегии резервного копирования базы данных**

Для обеспечения надежности и восстановления данных в случае сбоев разработана многоуровневая стратегия резервного копирования:

**1. Полное резервное копирование (ежедневно)**

```bash
# Команда для полного резервного копирования
pg_dump -U car_admin -d car_dealership -F c -b -v -f "/backups/car_dealership_$(date +%Y%m%d).backup"
```

**2. Инкрементальное копирование WAL-файлов (непрерывно)**

```sql
-- Настройка архивации WAL в postgresql.conf
wal_level = replica
archive_mode = on
archive_command = 'cp %p /backups/wal_archive/%f'
```

**3. Резервное копирование критичных данных (еженедельно)**

```sql
-- Экспорт только структуры без данных
pg_dump -U car_admin -d car_dealership --schema-only -f "/backups/schema_$(date +%Y%m%d).sql"

-- Экспорт справочных данных
pg_dump -U car_admin -d car_dealership --table=positions --table=suppliers -f "/backups/reference_data_$(date +%Y%m%d).sql"
```

**4. Автоматизация резервного копирования**

#### Создание скрипта резервного копирования (`backup.sh`):

```bash
#!/bin/bash
BACKUP_DIR="/backups"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="car_dealership"

# Создание полной резервной копии
pg_dump -U car_admin -d $DB_NAME -F c -b -v -f "$BACKUP_DIR/full_${DB_NAME}_${DATE}.backup"

# Удаление резервных копий старше 30 дней
find $BACKUP_DIR -name "*.backup" -mtime +30 -delete
```

#### Настройка планировщика задач (crontab):

```
# Ежедневное резервное копирование в 2:00 ночи
0 2 * * * /bin/bash /scripts/backup.sh

# Еженедельное полное резервное копирование в воскресенье в 3:00
0 3 * * 0 /bin/bash /scripts/full_backup.sh
```

**5. Восстановление из резервной копии**

#### Восстановление полной резервной копии:

```bash
# Остановка подключений к базе данных
pg_ctl stop -D /var/lib/postgresql/data

# Восстановление из резервной копии
pg_restore -U postgres -d car_dealership -v "/backups/car_dealership_20241218.backup"

# Запуск сервера
pg_ctl start -D /var/lib/postgresql/data
```

#### Восстановление до точки во времени (PITR):

```bash
# Восстановление из полной копии и WAL-архива
pg_restore -U postgres -d car_dealership -v "/backups/full_backup.backup"
recovery_target_time = '2024-12-18 14:30:00'
```

**6. Мониторинг и тестирование резервных копий**

#### Проверка целостности резервных копий:

```bash
# Проверка резервной копии без восстановления
pg_restore -l "/backups/car_dealership_20241218.backup" > /dev/null
if [ $? -eq 0 ]; then
    echo "Резервная копия корректна"
else
    echo "Ошибка в резервной копии"
fi
```

#### Регулярное тестирование восстановления:

- Ежемесячное тестовое восстановление на тестовом сервере
- Проверка целостности данных после восстановления
- Документирование процедуры восстановления

**Ключевые принципы стратегии резервного копирования:**

1. **Правило 3-2-1:**
   - 3 копии данных
   - 2 различных типа носителей
   - 1 копия в удаленном местоположении

2. **Регулярное тестирование:** Ежемесячная проверка возможности восстановления

3. **Аудит и мониторинг:** Логирование всех операций резервного копирования

4. **Безопасное хранение:** Шифрование резервных копий и ограничение доступа

Данная стратегия обеспечивает защиту данных автомобильного центра от потерь вследствие аппаратных сбоев, человеческих ошибок или программных ошибок, гарантируя непрерывность бизнес-процессов.

## <a id="conclusion">Заключение</a>

В ходе реализации проекта базы данных для автомобильного центра были успешно выполнены все поставленные задачи:

1. **Разработана структура базы данных**, включающая 6 взаимосвязанных таблиц с учетом бизнес-логики предметной области
2. **Реализована система управления доступом** с разделением прав для различных категорий пользователей
3. **Созданы оптимизированные запросы и представления** для удобной работы с данными
4. **Разработана стратегия резервного копирования** для обеспечения надежности хранения данных
5. **Произведена индексация критичных полей** для повышения производительности системы

База данных соответствует требованиям нормализации (3NF), обеспечивает целостность данных через систему ограничений и внешних ключей, а также предоставляет удобный интерфейс для работы через представления.

Система может быть расширена дополнительным функционалом и в будущем могла бы использоваться в реальных условиях работы автомобильного центра.

## <a id="literature">Список использованных информационных источников</a>

PostgreSQL 15. Официальная документация. – URL: https://www.postgresql.org/docs/15/index.html

Коннолли, Т., Бегг, К. Базы данных. Проектирование, реализация и сопровождение. Теория и практика. – 3-е изд. : пер. с англ. – М. : Вильямс, 2003. – 1436 с.

Дейт, К. Дж. Введение в системы баз данных. – 8-е изд. : пер. с англ. – М. : Вильямс, 2005. – 1328 с.

Карпова Т.С. Базы данных: модели, разработка, реализация. – СПб.: Питер, 2001. – 304 с.

Робинсон, С., Корнелл, Д., Морс, Д. PostgreSQL. Основы языка SQL. – СПб.: Символ-Плюс, 2005. – 496 с.

Материалы лекций и практических занятий по МДК 11.01 "Технология разработки и защиты баз данных".

<a id="applications">Приложения</a>
Приложение А. ER-диаграмма базы данных "Автомобильный центр".
(![ER-диаграмма](diagram.jpg)

Приложение Б. Полный SQL-скрипт создания базы данных (create_tables.sql).

Приложение В. Скрипт с тестовыми данными (insert_test_data.sql).

Приложение Г. Скрипт с примерами запросов и отчетов (example_queries.sql).
