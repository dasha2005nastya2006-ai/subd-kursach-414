### <p align="center"> Министерство образования, науки и молодежной политики Республики Коми

### <p align="center"> ГПОУ «Сыктывкарский политехнический техникум»

## <p align="center"> Курсовая работа

## <p align="center"> Разработка базы данных для домашней библиотеки </p>

#### <p align="right"> выполнила

 <p align="right">студентка 4 курса

<p align="right">414 группы

<p align="right">Егорова Юлия Викторовна

#### <p align="right">проверил

<p align="right">Пунгин И.В.

<p align="right">дата проверки:

<p align="center">Сыктывкар, 2025 г.

***
## <a id="content">Содержание</a>

1. [Введение](#introduction)
    - [Актуальность темы.](#relevance)
    - [Цель работы.](#purpose)
    - [Задачи работы.](#tasks)
      
2. [Основная часть](#main)
    - [Перечень используемого ПО при разработке.](#software)
    - [Анализ предметной области.](#analysis)
    - [Функциональные требования к БД.](#functional-requirements)
    - [Нефункциональные требования к БД.](#non-functional-requirements)
    - [Перечень входных данных.](#input-data)
    - [Перечень выходных данных](#output-data)
    - [Ограничения предметной области.](#limitations)
    - [Взаимодействие с другими программами.](#interaction)
      
3. [Инфологическая (концептуальная) модель базы данных](#conceptual-model)
    - [Выделение информационных объектов.](#inf_objects)
    - [Определение атрибутов объектов.](#att_objects)
    - [Определение отношений и мощности отношений между объектами.](#relationships_objects)
    - [Построение концептуальной модели.](#concept_model)
      
5. [Логическая структура БД](#logical-structure)
6. [Физическая структура базы данных](#physical-structure)
7. [Реализация проекта в среде конкретной СУБД](#implementation)



## <a id="introduction"> <p align="center"> Введение </a>

### <a id="relevance"> Актуальность темы </a>

По данным исследования ВЦИОМ, большинство россиян (87%) имеют домашние библиотеки. Эти коллекции зачастую состоят из научной и художественной литературы. При этом размер этих библиотек варьируется: у половины семей (50%) они насчитывают до 100 книг. Коллекции объёмом от 100 до 300 книг встречаются у 21% опрошенных. Более обширные собрания имеются у 18% респондентов, среди которых 9% владеют 300-500 книгами, 5% — 500-1000, и 4% — свыше тысячи книг. Отсутствие книг дома отмечено у 11% россиян.

Владельцы таких библиотек активно взаимодействуют, обмениваясь изданиями и организуя литературные клубы. В контексте такого обмена или личного пользования возникает необходимость в систематизированном учёте книг. Традиционные методы учёта, такие как ведение записей на бумаге, становятся неэффективными при значительном объёме коллекции, а также затрудняют получение общей статистики и поиск информации.

Именно для решения этих задач актуальной становится разработка базы данных (БД) для домашней библиотеки. Она предназначена для автоматизации учёта состояния, местонахождения и выдачи книг, что особенно важно для редких или лично ценных экземпляров. Кроме того, такая система позволяет эффективно управлять коллекциями, включающими собственные авторские произведения или сборники. Использование БД обеспечивает лёгкий доступ к информации, упрощает инвентаризацию и аналитику.

### <a id="purpose"> Цель работы </a>

Проектирование и реализация реляционной базы данных для комплексного учёта домашней библиотеки с интегрированной системой возрастных ограничений, а также специальных пометок в соответствии с законодательством РФ. Системное управление книжным домашним фондом, которое должно быть эффективным и понятным для гостя и администратора БД.

### <a id="tasks"> Задачи работы </a>

#### 1. Анализ предметной области и формирование требований к базе данных

1.1. Провести исследование особенностей домашних библиотек как объекта автоматизации, выделить ключевые сущности и атрибуты (учёт книг, выдача, возврат, контроль состояния).

1.2. Изучить законодательные требования Федерального закона №436-ФЗ "О защите детей от информации" и определить механизмы их технической реализации в БД (система возрастных рейтингов 0+, 6+, 12+, 16+, 18+).

#### 2. Проектирование архитектуры и моделей базы данных

2.1. Разработать модель-схему в виде ER-диаграммы, отображающую сущности предметной области (Книга, Автор, Экземпляр, Пользователь, Местоположение и другие) и связи между ними.

2.2. Спроектировать логическую модель реляционной базы данных, а именно преобразование ER-диаграммы в схему таблиц, определение типов данных для полей, установление первичных и внешних ключей.

2.3. Создать физическую модель для СУБД PostgreSQL, определив стратегии индексирования, секционирования, хранения данных и оптимизации производительности.

#### 3. Разработка и реализация структуры базы данных в СУБД PostgreSQL

3.1. Реализовать DDL-скрипты для создания всех таблиц базы данных с использованием современных возможностей PostgreSQL.

3.2. Спроектировать модель ролевого доступа (RBAC) с тремя уровнями привилегий: Администратор (полный доступ), Библиотекарь (операции с книгами и выдачей), Гость (только чтение справочной информации).

3.3. Настроить систему аудита и протоколирования всех значимых событий в отдельной таблице журнала (логирование выдачи/возврата, попыток нарушения доступа, изменений данных администратором).

#### 4. Тестирование и подготовка документации

4.1. Провести комплексное тестирование базы данных: функциональное тестирование всех разработанных процедур и триггеров, тестирование ключевых запросов, тестирование на корректность работы ограничений целостности и других команд, отвечающих за корректную работу базы данных.

4.2. Подготовить демонстрационные данные и сценарии использования, наглядно показывающие работу всех функций БД, включая работу системы возрастных ограничений и механизмов безопасности.

## <a id="main"> <p align="center"> Основная часть </a>

###  <a id="software"> Перечень используемого ПО при разработке. </a>

В данном разделе рассматриваются основные условия, в которых разрабатывается БД, а также нюансы использования СУБД PostgreSQL для проектирования, разработки и практического применения БД.

#### 1. Операционная система Windows 11

Windows 11 — это современная ОС на базе гибридного ядра Windows NT, разработанная компанией Microsoft для персональных компьютеров, рабочих станций и серверов. Архитектура Windows 11 оптимизирована для разработки и развёртывания сложных приложений, включая системы управления базами данных.

#### 2. СУБД PostgreSQL

##### 2.1. Структурирование, организация данных и принцип работы

PostgreSQL предоставляет упорядоченные механизмы для создания и управления структурированными базами данных. Система позволяет проектировать сложные модели данных через систему таблиц, где каждая таблица представляет собой отдельную сущность предметной области (например, "Книга", "Автор", "Читатель").

Таблицы состоят из столбцов с заранее определёнными типами данных (текст, числа, даты), что обеспечивает строгую типизацию и предотвращает ошибки при вводе информации. Связи между таблицами устанавливаются через механизмы внешних ключей, создавая единую целостную структуру.

##### 2.2. Обеспечение целостности данных

Одной из ключевых возможностей PostgreSQL является встроенная система ограничений целостности. Разработчик может определить:

2.2.1. Первичные ключи для уникальной идентификации каждой записи;

2.2.2. Внешние ключи для поддержания ссылочной целостности между таблицами;

2.2.3. CHECK-ограничения для проверки значений на соответствие бизнес-правилам (например, год издания не может быть больше текущего года);

2.2.4. UNIQUE-ограничения для предотвращения дублирования данных.

Эти механизмы работают на уровне ядра СУБД, гарантируя, что в базе данных не появятся некорректные или противоречивые записи.

##### 2.3. Система безопасности и контроля доступа

Безопасность данных обеспечивается многоуровневой системой:

2.3.1. Аутентификация пользователей через различные методы (пароль, SSL-сертификаты);

2.3.2. Авторизация через систему привилегий GRANT/REVOKE на уровне объектов базы данных;

2.3.3. Безопасность на уровне строк (RLS), позволяющая ограничивать доступ к отдельным записям в таблице;

2.3.4. Аудит и журналирование всех значимых событий в системе;

2.3.5. Шифрование соединений через SSL/TLS для защиты передаваемых данных.

##### 2.4. Расширяемость и автоматизация бизнес-процессов

PostgreSQL поддерживает создание собственной бизнес-логики:

2.4.1. Хранимые процедуры и функции на языке pgSQL для реализации сложных алгоритмов;

2.4.2. Триггеры — автоматически выполняемые процедуры при наступлении определённых событий (вставка, обновление, удаление);

2.4.3. Планировщик заданий pg_cron для выполнения периодических операций;

2.4.4. Расширения (extensions) для добавления новой функциональности (геопространственные данные, полнотекстовый поиск и др.).

#### 3. Графический клиент-приложение pgAdmin 4

 PgAdmin4 — это веб-приложение с открытым исходным кодом для управления и администрирования баз данных PostgreSQL. Данная модификация предоставляет удобный интерфейс для выполнения SQL-запросов, управления объектами базы данных, мониторинга производительности и многого другого.

##### 3.1. Визуальное проектирование и моделирование данных

3.1.1. Графический конструктор таблиц с возможностью определения типов данных, ограничений и значений по умолчанию;

3.1.2. Редактор ER-диаграмм для визуального отображения связей между сущностями;

3.1.3. Мастер создания внешних ключей с автоматической генерацией соответствующих SQL-команд;

3.1.4. Инструменты для создания диаграмм из существующих баз данных;

##### 3.2. Работа с содержимым базы данных

3.2.1. Табличный редактор данных, с поддержкой вставки, редактирования и удаления и связки записей;

3.2.2. Импорт данных из CSV, Excel и других форматов через графический интерфейс;

3.2.3. Визуальный конструктор запросов Query Tool для построения SQL-запросов без написания кода.

### <a id="analysis">Требования к архитектуре БД домашней библиотеки </a>
Для начала работы необходимо теоретически проанализировать ежедневную работу домашних, а также государственных и частных библиотек, найти литературу и статьи о их работе, принципах ведения учёта и выдачи книг. Изучить нормативно-правовую базу, чтобы не нарушить законодательство Российской Федерации при некоторых аспектах. 

Типичные операции, которые выполняются при управлении личным книжным фондом: от простой каталогизации новых поступлений до сложных процессов отслеживания выданных книг и контроля их состояния, становятся неэффективными уже при коллекции в 100-150 книг, вызывая трудности с поиском, дублированием записей и получением общей статистики. Также были изучены потребности в автоматизации рутинных процессов: автоматической проверке возрастных ограничений при выдаче книг детям, напоминаниях о возврате, ведении истории состояния экземпляров и генерации отчётов о наиболее популярных книгах. Этот анализ позволил выделить ключевые функции, которые действительно необходимы пользователям, и отсечь избыточные возможности, усложняющие систему.
Важнейшим аспектом формирования требований стало изучение законодательных актов, регулирующих обращение печатной продукции в Российской Федерации. Центральное место занял *Федеральный закон №436-ФЗ "О защите детей от информации, причиняющей вред их здоровью и развитию"*, который устанавливает обязательную возрастную маркировку для всех видов контента, включая книги. В соответствии с этим законом, все книги должны классифицироваться по возрастным категориям: 0+, 6+, 12+, 16+, 18+. Система обязана выдавать дополнительное уведомление для выдающего о проверки соответствия возраста читателя и возрастного рейтинга книги при каждой выдаче, а также вести журнал таких проверок. Дополнительно были учтены правовые аспекты учёта авторских прав — система должна позволять отмечать информацию об авторах, включая их статус (отечественный/зарубежный, с указанием на особые правовые статусы, такие как "иностранный агент"). Эти требования обеспечивают не только функциональность системы, но и её юридическую корректность при использовании в российских реалиях.

Требования к системе разрабатывались с учётом реальных технических условий, в которых будет эксплуатироваться база данных. Был проведён анализ характеристик типовых домашних компьютеров — большинство пользователей имеют ПК с 4-8 ГБ оперативной памяти, процессорами среднего класса и обычными жёсткими дисками или SSD-накопителями. Это определило требования к производительности: система должна работать стабильно на таком оборудовании даже при каталоге в несколько тысяч книг. Оценка возможностей современных систем управления базами данных, в частности PostgreSQL, позволила заложить в требования продвинутые функции: сложные ограничения целостности, триггеры для автоматической проверки бизнес-правил, механизмы полнотекстового поиска и систему ролевого доступа. Также были учтены требования к простоте развёртывания — система должна устанавливаться на стандартную Windows без необходимости сложной настройки серверного окружения, что соответствует возможностям типичного домашнего пользователя.

#### После анализа можно сделать выводы по необходимому функционалу БД для домашней библиотеки:

### <a id="functional-requirements"> 1. Функциональные требования </a>

#### 1.1. Управление книжным фондом

1.1.1. Учёт физических экземпляров с уникальными инвентарными номерами;

1.1.2. Регистрация состояния каждого экземпляра с историей изменений;

1.1.3. Отслеживание мест хранения книг;

1.1.4. Контроль условий хранения для ценных изданий.

#### 1.2. Каталогизация и классификация;

1.2.1. Гибкая система добавления новых жанров и категорий;

1.2.2. Множественная классификация изданий (по авторам, жанрам, тегам);

1.2.3. Поддержка расширенных характеристик книг;

1.2.4. Возрастная маркировка согласно законодательству РФ.

#### 1.3. Управление пользователями и доступом.

1.3.1. Трёхуровневая система ролей (администратор,
библиотекарь, гость);

1.3.2. Регистрация читателей с обязательным указанием даты
рождения;

1.3.3. Автоматический расчёт возраста пользователей;

1.3.4. Система аудита всех действий пользователей.

#### 1.4. Учёт выдачи и возврата книг.

1.4.1. Полная регистрация операций выдачи/возврата;

1.4.2. Автоматическая проверка возрастных ограничений;

1.4.3. Контроль сроков возврата с системой уведомлений;

1.4.4. Предотвращение двойной выдачи одного экземпляра.

#### 1.5. Поиск и аналитика.

1.5.1. Расширенный поиск по множеству критериев;

1.5.2. Формирование отчётов о популярности и активности;

1.5.3. Статистический анализ читательских предпочтений;

1.5.4. Мониторинг состояния книжного фонда.

### <a id="non-functional-requirements"> 2. Нефункциональные требования </a>

2.1. Правовое соответствие;

2.1.1. Соблюдение Федерального закона №436-ФЗ;

2.1.2. Обязательная возрастная маркировка книг;

2.1.3. Поддержка отметок об особых статусах авторов.
 
#### 2.2. Безопасность и контроль доступа

2.2.1. Разграничение прав на операции с данными;

2.2.2. Безопасность на уровне строк для персональных данных;

2.2.3. Защита от несанкционированных изменений.

#### 2.3. Гибкость и расширяемость

2.3.1. Возможность добавления новых полей без перестройки
структуры;

2.3.2. Поддержка множественной классификации изданий;

2.3.3. Совместимость с будущими расширениями функционала.

#### 2.4. Доступность и экономичность

2.4.1. Использование бесплатной СУБД PostgreSQL;

2.4.2. Работа на стандартном домашнем оборудовании;

2.4.3. Минимальные требования к квалификации пользователя.

#### 2.5. Производительность и надёжность

2.5.1. Стабильная работа с каталогом до нескольких тысяч книг;

2.5.2. Быстрый поиск и формирование отчётов;

2.5.3. Надёжное хранение данных и история изменений;

2.5.4. Данные о литературных произведениях.

### <a id="input-data"> 3. Перечень входных данных. </a>

#### 3.1 Библиографические данные:

3.1.1. Название книги (обязательное поле);

3.1.2. Оригинальное название (для иностранной литературы);

3.1.3. Год издания;

3.1.4. Издательство;

3.1.5. Количество страниц;

3.1.6. Аннотация/краткое содержание.

#### 3.2. Классификационные данные:

3.2.1. Возрастной рейтинг (0+, 6+, 12+, 16+, 18+) — обязательное поле согласно 436-ФЗ;

3.2.2. Жанры (множественный выбор).

#### 3.3. Данные об авторах:

3.3.1. Фамилия;

3.3.2. Имя;

3.3.3. Отчество;

3.3.4. Год рождения;

3.3.5. Год смерти (для умерших авторов);

3.3.6. Страна происхождения;

3.3.7. Специальные отметки (иностранный агент, лауреат премий и т.д.);

3.3.8. Альтервнативные пометки авторства (народный фольклор, утерянное авторство).

#### 3.4. Данные о физических экземплярах книг:

3.4.1. Уникальный инвентарный номер (обязательное поле)

3.4.3. Дата поступления в библиотеку;

3.4.5. Физическое состояние (отличное, хорошее, удовлетворительное, плохое);

3.4.6. Особые отметки (автограф автора, повреждения).

#### 3.5. Данные о хранении:

3.5.1. Место хранения (комната, шкаф, полка)

#### 3.6. Данные о пользователях системы:

3.6.1. Фамилия (обязательное поле);

3.6.2. Имя (обязательное поле);

3.6.3. Отчество;

3.6.4. Дата рождения (обязательное поле для проверки возрастных ограничений);

3.6.5. Контактная информация (email, телефон);

3.6.6. Логин и пароль для доступа к системе.

3.6.7. Роль в системе (администратор, библиотекарь, гость)

### <a id="output-data"> 4. Перечень выходных данных. </a>

#### 4.1. Полный каталог книг.

4.1.1. Список всех книг с библиографическими данными (название, автор, год издания, издательство);

4.1.2. Классификация по жанрам и возрастным рейтингам;

4.1.3. Информация о доступности экземпляров.

#### 4.2. Авторский указатель.

4.2.1. Алфавитный список авторов с их произведениями;

4.2.2. Статистика по авторам (количество книг, годы жизни, страна);

4.2.3. Специальные пометки об авторах (лауреаты премий, особые статусы).

#### 4.3. Систематический каталог.

4.3.1. Группировка книг по жанрам и тематикам;

4.3.2. Кросс-справочные указатели (автор-жанр, жанр-рейтинг);

4.3.3. Инвентарные описи по местам хранения.

#### 4.4. Журнал выдачи и возврата книг.

4.4.1. Хронологический список всех операций выдачи;

4.4.2. Информация о текущих задолженностях (книги на руках);

4.4.3. История выдачи по каждому читателю и экземпляру;

4.4.4. Лог проверок возрастных ограничений при выдаче;

4.4.5. Статистика нарушений возрастных ограничений;

4.4.6. Список книг, требующих особого контроля при выдаче.

### <a id="limitations"> 5. Ограничения предметной области. </a>

#### 5.1. Законодательные ограничения.

5.1.1. Все книги должны иметь обязательную возрастную маркировку: (0+), (6+), (12+), (16+), (18+);

5.1.2. Запрещена выдача книг с рейтингом 18+ читателям младше 18 лет;

5.1.3. Требуется обязательная проверка возраста читателя при выдаче книг с рейтингом 16+.

#### 5.2. Авторское право.

5.2.1. Отметка об особых правовых статусах авторов.

#### 5.3. Функциональные ограничения.

5.3.1. Один экземпляр книги не может быть выдан одновременно нескольким читателям;

5.3.2. Максимальный срок выдачи книги - 30 дней;

5.3.3. Ограничение количества одновременно взятых книг на одного читателя - 5 экземпляров.

#### 5.4. Ограничения по учёту экземпляров.

5.4.1. Уникальный инвентарный номер для каждого физического экземпляра;

5.4.2. Запрет удаления книг с активными выдачами.

#### 5.5. Ограничения данных.

5.5.1. Максимальное количество книг в базе - 10 000 записей

5.5.2. Максимальное количество читателей - 100 человек

5.5.3. Ограничение на длину текстовых полей:

* Название книги: не более 200 символов

* ФИО автора: не более 100 символов

* Описание: не более 2000 символов

#### 5.6. Временные ограничения.

5.6.1. Год издания книги не может быть больше текущего года;

5.6.2. Дата рождения читателя должна быть не позднее текущей даты;

5.6.3. Дата выдачи книги не может быть раньше даты поступления экземпляра;

5.6.4. Срок возврата должен быть не ранее даты выдачи.

#### 5.7. Ограничения доступности.

5.7.1. Книги могут находиться только в трех состояниях: "доступна", "выдана", "требуется реставрация";

5.7.2. Экземпляры в состоянии "требуется реставрация" не могут быть выданы;

5.7.3. Книги с состоянием "плохое" требуют подтверждения администратора для выдачи.

#### 5.8. Ограничения безопасности.

5.8.1. Гости могут только просматривать каталог книг;

5.8.2. Библиотекари не могут удалять пользователей и изменять системные настройки;

5.8.3. Только администратор может изменять возрастные рейтинки и системные справочники;

5.8.3. Запрещен доступ к персональным данным других пользователей.

#### 5.9. Ограничения целостности данных.

5.9.1. Запрещено удаление авторов, у которых есть книги в базе;

5.9.2. Запрещено удаление жанров, которые используются в классификации книг;

5.9.3. Невозможность изменить инвентарный номер существующего экземпляра;

5.9.4. Сохранение истории всех изменений критических данных.

### <a id="interaction"> 6. Взаимодействие с другими программами. </a>

*будет дополнено*

## <a id="conceptual-model"> <p align = "center"> Инфологическая (концептуальная) модель базы данных </a>

### Выделение информационных объектов

На основе анализа предметной области были выделены следующие ключевые информационные объекты:

#### <a id="inf_objects"> Основные информационные объекты: </a>
### Выделение информационных объектов

На основе анализа предметной области были выделены следующие ключевые информационные объекты:

#### <a id="inf_objects"> Основные информационные объекты: </a>

1. **КНИГА (BOOK)** - библиографическое описание литературного произведения
   - Уникальное описание произведения независимо от количества экземпляров
   - Содержит метаданные: название, год издания, издательство и т.д.

2. **АВТОР (AUTHOR)** - создатель литературного произведения
   - Может быть физическим лицом или иметь особый статус (фольклор, неизвестный автор)
   - Одна книга связана с одним автором (связь 1:N согласно диаграмме)

3. **ЧИТАТЕЛЬ (USER)** - пользователь библиотеки
   - Человек, который берет книги для чтения
   - Имеет обязательные данные для идентификации и проверки возрастных ограничений

4. **ЭКЗЕМПЛЯР (COPY)** - физический экземпляр книги
   - Конкретная книга, которую можно взять в руки
   - Имеет уникальный инвентарный номер и собственное состояние

#### Справочные сущности:

5. **ВОЗРАСТНОЙ РЕЙТИНГ (AGE_RATING)** - классификация по возрастным ограничениям
   - Фиксированный набор значений: 0+, 6+, 12+, 16+, 18+
   - Определяет минимальный возраст читателя для выдачи книги

6. **ЖАНР (GENRE)** - литературный жанр произведения
   - Категория для классификации книг (роман, детектив, фантастика и т.д.)
   - Одна книга может относиться к нескольким жанрам (требуется таблица связей)

7. **МЕСТО ХРАНЕНИЯ (LOCATION)** - физическое расположение книги
   - Иерархическая структура: комната → шкаф/мебель → полка
   - Позволяет быстро находить книги в пространстве

### Операционные сущности:

8. **ВЫДАЧА (LOAN)** - факт выдачи книги читателю
   - Фиксирует момент передачи экземпляра и обязательство возврата
   - Содержит информацию о проверке возрастных ограничений

### <a id="att_objects"> Определение атрибутов объектов </a>

#### *КНИГА (BOOK):*
- *Идентификатор книги* (book_id) - уникальный числовой идентификатор (PK)
- *Возрастной рейтинг* (rating_id) - ссылка на AGE_RATING (FK)
- *Автор* (author_id) - ссылка на AUTHOR (FK)
- *Название* (title) - название произведения (обязательное поле)
- *Оригинальное название* (original_title) - для иностранной литературы
- *Год издания* (publication_year) - год публикации
- *Издательство* (publisher) - название издательства
- *Описание* (description) - аннотация или краткое содержание
- *Дата создания записи* (created_at) - когда книга внесена в каталог

#### *АВТОР (AUTHOR):*
- *Идентификатор автора* (author_id) - уникальный числовой идентификатор (PK)
- *Фамилия* (last_name) - фамилия автора
- *Имя* (first_name) - имя автора
- *Отчество* (middle_name) - отчество автора (при наличии)
- *Год рождения* (birth_year) - год рождения автора
- *Год смерти* (death_year) - год смерти (если автор умер)
- *Страна* (country) - страна происхождения
- *Особые отметки* (special_notes) - статусы: лауреат премий, иностранный агент и т.д.
- *Тип авторства* (author_type) - индивидуальный, народный, неизвестный

#### *ЧИТАТЕЛЬ (USER):*
- *Идентификатор читателя* (user_id) - уникальный числовой идентификатор (PK)
- *Фамилия* (last_name) - фамилия читателя (обязательное поле)
- *Имя* (first_name) - имя читателя (обязательное поле)
- *Отчество* (middle_name) - отчество читателя
- *Дата рождения* (birth_date) - дата рождения (обязательное для возрастного контроля)
- *Электронная почта* (email) - контактный email
- *Телефон* (phone) - контактный телефон
- *Роль в системе* (role) - администратор, библиотекарь, читатель и т.д.
- *Статус активности* (is_active) - активен/заблокирован

#### *ЭКЗЕМПЛЯР (COPY):*
- *Идентификатор экземпляра* (copy_id) - уникальный числовой идентификатор (PK)
- *Книга* (book_id) - ссылка на BOOK (FK)
- *Место хранения* (location_id) - ссылка на LOCATION (FK)
- *Инвентарный номер* (inventory_number) - уникальный физический номер (обязательное поле)
- *Дата поступления* (acquisition_date) - когда книга попала в библиотеку
- *Стоимость приобретения* (purchase_price) - цена покупки
- *Оценочная стоимость* (estimated_value) - текущая рыночная стоимость
- *Состояние* (condition) - отличное, хорошее, удовлетворительное, плохое
- *Особые отметки* (special_notes) - автографы, повреждения, экслибрисы
- *Доступность* (is_available) - доступен для выдачи или нет

#### *ВОЗРАСТНОЙ РЕЙТИНГ (AGE_RATING):*
- *Идентификатор рейтинга* (rating_id) - уникальный числовой идентификатор (PK)
- *Код рейтинга* (code) - текстовое или числовое обозначение
- *Минимальный возраст* (min_age) - минимально допустимый возраст читателя
- *Описание* (description) - пояснение рейтинга

#### *ЖАНР (GENRE):*
- *Идентификатор жанра* (genre_id) - уникальный числовой идентификатор (PK)
- *Название жанра* (name) - наименование жанра (обязательное поле)
- *Описание* (description) - характеристика жанра

#### *МЕСТО ХРАНЕНИЯ (LOCATION):*
- *Идентификатор места* (location_id) - уникальный числовой идентификатор (PK)
- *Комната* (room) - номер или название комнаты
- *Шкаф/стеллаж* (furniture) - тип мебели для хранения
- *Полка* (shelf) - номер или обозначение полки
- *Описание* (description) - дополнительные сведения о месте

#### *ВЫДАЧА (LOAN):*
- *Идентификатор выдачи* (loan_id) - уникальный числовой идентификатор (PK)
- *Экземпляр* (copy_id) - ссылка на COPY (FK)
- *Читатель* (user_id) - ссылка на USER (FK)
- *Дата выдачи* (loan_date) - когда книга выдана (обязательное поле)
- *Срок возврата* (due_date) - когда должна быть возвращена
- *Дата возврата* (return_date) - фактическая дата возврата
- *Приостановка возрастной проверки* (age_check_paused) - отметка о приостановке проверки
- *Примечания* (notes) - дополнительные сведения о выдаче

### <a id="relationships_objects"> Определение отношений и мощности отношений между объектами </a>

#### Основные отношения:

1. **КНИГА → АВТОР** (многие-к-одному)
   - Одна книга связана с одним автором (согласно диаграмме)
   - Один автор может написать несколько книг
   - *Мощность:* N:1
   - *Реализация:* FK author_id в таблице BOOK

2. **КНИГА ←→ ЖАНР** (многие-ко-многим)
   - Одна книга может относиться к нескольким жанрам
   - Один жанр может включать много книг
   - *Мощность:* M:N
   - *Реализация через таблицу:* BOOK_GENRE (требуется дополнительная таблица)

3. **КНИГА → ЭКЗЕМПЛЯР** (один-ко-многим)
   - Одна книга (библиографическое описание) может иметь несколько физических экземпляров
   - Один экземпляр относится только к одной книге
   - *Мощность:* 1:N
   - *Реализация:* FK book_id в таблице COPY

4. **ЭКЗЕМПЛЯР → МЕСТО ХРАНЕНИЯ** (многие-к-одному)
   - Один экземпляр хранится в одном месте
   - В одном месте может храниться много экземпляров
   - *Мощность:* N:1
   - *Реализация:* FK location_id в таблице COPY

5. **КНИГА → ВОЗРАСТНОЙ РЕЙТИНГ** (многие-к-одному)
   - Одна книга имеет один возрастной рейтинг
   - Один рейтинг может быть присвоен многим книгам
   - *Мощность:* N:1
   - *Реализация:* FK rating_id в таблице BOOK

6. **ЧИТАТЕЛЬ → ВЫДАЧА** (один-ко-многим)
   - Один читатель может брать много книг (в разное время)
   - Одна выдача относится к одному читателю
   - *Мощность:* 1:N
   - *Реализация:* FK user_id в таблице LOAN

7. **ЭКЗЕМПЛЯР → ВЫДАЧА** (один-ко-многим)
   - Один экземпляр может выдаваться много раз (в разное время)
   - Одна выдача относится к одному экземпляру
   - *Мощность:* 1:N
   - *Реализация:* FK copy_id в таблице LOAN

### Дополнительные ограничения отношений:

8. **Временные ограничения:**
   - Дата выдачи ≤ Срок возврата
   - Дата возврата ≥ Дата выдачи (если возвращено)
   - Год издания ≤ Текущий год
   - Дата рождения читателя ≤ Текущая дата
   - Дата смерти автора ≥ Дата рождения автора (если указана)

9. **Бизнес-ограничения:**
   - Нельзя выдать уже выданный экземпляр (без даты возврата)
   - Нельзя выдать книгу читателю младше возрастного рейтинга (кроме случаев age_check_paused)
   - Максимум 5 книг одновременно у одного читателя (логика на уровне приложения)
   - Экземпляр с is_available = FALSE нельзя выдать
   - Инвентарный номер должен быть уникальным

### <a id="concept_model"> Построение концептуальной модели</a>

Концептуальная модель базы данных является фундаментальным этапом проектирования, который позволяет визуализировать структуру данных и взаимосвязи между сущностями предметной области без привязки к конкретной СУБД. На основе проведённого анализа предметной области, функциональных и нефункциональных требований, а также выделенных информационных объектов была разработана ER-диаграмма (Entity-Relationship Diagram), отражающая ключевые сущности домашней библиотеки и отношения между ними.

#### Методология разработки ER-диаграммы

Разработка ER-диаграммы осуществлялась в соответствии со следующими принципами:

1. **Идентификация объектов** — на основе анализа предметной области были выделены основные сущности: Книга (BOOK), Автор (AUTHOR), Читатель (USER), Экземпляр (COPY), а также справочные сущности: Возрастной рейтинг (AGE_RATING), Жанр (GENRE) и Место хранения (LOCATION).

2. **Определение атрибутов** — для каждой сущности были определены ключевые атрибуты с учётом бизнес-требований и законодательных ограничений (Федеральный закон №436-ФЗ).

3. **Установление отношений** — между сущностями были определены связи с указанием мощности (кардинальности) отношений:
   - Один-ко-многим (1:N)
   - Многие-ко-многим (M:N)
   - Один-к-одному (1:1)

4. **Визуальное представление** — для наглядности использована нотация "Crow's Foot" (нотация "воронья лапка"), которая является стандартом де-факто в проектировании баз данных.

#### Ключевые отношения на диаграмме

Диаграмма наглядно демонстрирует следующие основные отношения:

1. **Книга ↔ Автор** — связь многие-к-одному, где одна книга имеет одного автора, а один автор может написать несколько книг.

2. **Книга ↔ Жанр** — связь многие-ко-многим, реализуемая через дополнительную таблицу BOOK_GENRE.

3. **Книга ↔ Экземпляр** — связь один-ко-многим, где одно библиографическое описание соответствует нескольким физическим экземплярам.

4. **Экземпляр ↔ Выдача** — связь один-ко-многим, позволяющая отслеживать историю выдачи каждого экземпляра.

5. **Читатель ↔ Выдача** — связь один-ко-многим, фиксирующая все выдачи книг конкретному читателю.

#### **Фактическое изображение диаграммы:**

![ER-диаграмма базы данных домашней библиотеки](er-dia.jpg)

<p align="center"> *Рисунок 1 — ER-диаграмма базы данных домашней библиотеки*

## <a id="logical-structure"> Логическая структура БД </a>

Логическая структура базы данных представляет собой реализацию концептуальной модели в терминах реляционной модели данных. На данном этапе происходит преобразование сущностей и отношений ER-диаграммы в схему таблиц с конкретными типами данных, ограничениями целостности и определением связей между таблицами.

#### 1. Принципы преобразования ER-модели в реляционную схему

Преобразование концептуальной модели в логическую структуру осуществлялось по следующим правилам:

1. **Сущности → Таблицы** — каждая сущность ER-диаграммы преобразуется в отдельную таблицу.
2. **Атрибуты → Столбцы** — атрибуты сущностей становятся столбцами соответствующих таблиц.
3. **Первичные ключи** — для каждой таблицы определяется первичный ключ для уникальной идентификации записей.
4. **Внешние ключи** — отношения между сущностями реализуются через механизм внешних ключей.
5. **Отношения M:N → Промежуточные таблицы** — связи многие-ко-многим преобразуются в отдельные таблицы связей.
6. **Ограничения целостности** — добавляются CHECK-ограничения для обеспечения бизнес-правил.

#### 2. Список таблиц базы данных

Логическая схема базы данных домашней библиотеки включает следующие таблицы:

| № | Таблица | Назначение | Примерное количество записей |
|---|---------|------------|-----------------------------|
| 1 | `author` | Хранение информации об авторах книг | 5,000 |
| 2 | `age_rating` | Справочник возрастных рейтингов (согласно 436-ФЗ) | 5 |
| 3 | `genre` | Справочник литературных жанров | 50 |
| 4 | `book` | Библиографические описания книг | 10,000 |
| 5 | `book_genre` | Связь книг с жанрами (многие-ко-многим) | 30,000 |
| 6 | `location` | Справочник мест хранения | 100 |
| 7 | `copy` | Физические экземпляры книг | 15,000 |
| 8 | `user` | Пользователи системы (читатели, библиотекари, администраторы) | 100 |
| 9 | `loan` | Журнал выдачи и возврата книг | 50,000 |

### 3. Детальная спецификация таблиц

#### 3.1. Таблица `author` (Авторы)

**Назначение:** Хранение информации об авторах литературных произведений.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `author_id` | `SERIAL` | `PRIMARY KEY` | Уникальный идентификатор автора |
| `last_name` | `VARCHAR(50)` | `NOT NULL` | Фамилия автора |
| `first_name` | `VARCHAR(50)` | `NOT NULL` | Имя автора |
| `middle_name` | `VARCHAR(50)` | | Отчество автора (опционально) |
| `birth_year` | `INTEGER` | `NOT NULL`, `CHECK(birth_year > 0)` | Год рождения автора |
| `death_year` | `INTEGER` | `CHECK(death_year IS NULL OR death_year > birth_year)` | Год смерти (если применимо) |
| `country` | `VARCHAR(100)` | `NOT NULL` | Страна происхождения |
| `special_notes` | `TEXT` | | Особые отметки (лауреат, иностранный агент и т.д.) |
| `author_type` | `VARCHAR(20)` | `DEFAULT 'individual'`, `CHECK(author_type IN ('individual', 'folk', 'unknown', 'collective'))` | Тип авторства |

**Ключевые ограничения:**
- Первичный ключ: `author_id`
- Проверка корректности лет жизни: смерть не может быть раньше рождения
- Поддержка различных типов авторства (индивидуальный, народный, неизвестный)

#### 3.2. Таблица `age_rating` (Возрастные рейтинги)

**Назначение:** Справочник возрастных ограничений согласно Федеральному закону №436-ФЗ.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `rating_id` | `SERIAL` | `PRIMARY KEY` | Уникальный идентификатор рейтинга |
| `code` | `VARCHAR(3)` | `UNIQUE NOT NULL`, `CHECK(code IN ('0+', '6+', '12+', '16+', '18+'))` | Код рейтинга (соответствует законодательству) |
| `min_age` | `INTEGER` | `NOT NULL`, `CHECK(min_age IN (0, 6, 12, 16, 18))` | Минимальный допустимый возраст |
| `description` | `VARCHAR(200)` | `NOT NULL` | Описание рейтинга |

**Предопределенные значения:**
```sql
('0+', 0, 'Для любой возрастной категории'),
('6+', 6, 'Для детей старше 6 лет'),
('12+', 12, 'Для детей старше 12 лет'),
('16+', 16, 'Для детей старше 16 лет'),
('18+', 18, 'Только для взрослых')
```

#### 3.3. Таблица `genre` (Жанры)

**Назначение:** Справочник литературных жанров для классификации книг.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `genre_id` | `SERIAL` | `PRIMARY KEY` | Уникальный идентификатор жанра |
| `name` | `VARCHAR(100)` | `UNIQUE NOT NULL` | Наименование жанра |
| `description` | `TEXT` | | Описание характеристик жанра |

**Примеры жанров:** Роман, Детектив, Фантастика, Фэнтези, Поэзия, Драма, Комедия, Научная литература, Биография.

#### 3.4. Таблица `book` (Книги)

**Назначение:** Основная таблица библиографических описаний книг.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `book_id` | `SERIAL` | `PRIMARY KEY` | Уникальный идентификатор книги |
| `rating_id` | `INTEGER` | `NOT NULL`, `REFERENCES age_rating(rating_id)` | Возрастной рейтинг (FK) |
| `author_id` | `INTEGER` | `NOT NULL`, `REFERENCES author(author_id)` | Автор книги (FK) |
| `title` | `VARCHAR(200)` | `NOT NULL` | Название книги |
| `original_title` | `VARCHAR(200)` | | Оригинальное название (для переводной литературы) |
| `publication_year` | `INTEGER` | `NOT NULL`, `CHECK(publication_year <= EXTRACT(YEAR FROM CURRENT_DATE))` | Год издания |
| `publisher` | `VARCHAR(150)` | | Издательство |
| `description` | `TEXT` | | Аннотация или краткое содержание |
| `created_at` | `DATE` | `DEFAULT CURRENT_DATE` | Дата добавления в каталог |

**Ключевые ограничения:**
- Внешние ключи: `rating_id → age_rating`, `author_id → author`
- Проверка года издания: не может быть в будущем
- Ограничение длины названия: до 200 символов

#### 3.5. Таблица `book_genre` (Связь книг и жанров)

**Назначение:** Реализация связи многие-ко-многим между книгами и жанрами.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `book_id` | `INTEGER` | `NOT NULL`, `REFERENCES book(book_id) ON DELETE CASCADE` | Идентификатор книги (FK) |
| `genre_id` | `INTEGER` | `NOT NULL`, `REFERENCES genre(genre_id) ON DELETE CASCADE` | Идентификатор жанра (FK) |

**Ключевые особенности:**
- Составной первичный ключ: `(book_id, genre_id)`
- Каскадное удаление: при удалении книги или жанра удаляется соответствующая связь
- Одна книга может быть связана с несколькими жанрами

#### 3.6. Таблица `location` (Места хранения)

**Назначение:** Справочник физических мест хранения книг в доме.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `location_id` | `SERIAL` | `PRIMARY KEY` | Уникальный идентификатор места |
| `room` | `VARCHAR(50)` | `NOT NULL` | Комната/помещение (гостиная, кабинет, спальня) |
| `furniture` | `VARCHAR(50)` | `NOT NULL` | Тип мебели (книжный шкаф, стеллаж, полка) |
| `shelf` | `VARCHAR(20)` | `NOT NULL` | Номер или обозначение полки |
| `description` | `TEXT` | | Дополнительное описание места |

**Примеры значений:**
- `('Гостиная', 'Книжный шкаф', 'Верхняя полка', 'Для классической литературы')`
- `('Кабинет', 'Стеллаж', 'Секция А', 'Научная литература')`

#### 3.7. Таблица `copy` (Экземпляры)

**Назначение:** Учёт физических экземпляров книг.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `copy_id` | `SERIAL` | `PRIMARY KEY` | Уникальный идентификатор экземпляра |
| `book_id` | `INTEGER` | `NOT NULL`, `REFERENCES book(book_id)` | Библиографическое описание (FK) |
| `location_id` | `INTEGER` | `REFERENCES location(location_id)` | Текущее место хранения (FK) |
| `inventory_number` | `VARCHAR(50)` | `UNIQUE NOT NULL` | Уникальный инвентарный номер |
| `acquisition_date` | `DATE` | `DEFAULT CURRENT_DATE` | Дата поступления в библиотеку |
| `purchase_price` | `NUMERIC(10,2)` | `CHECK(purchase_price >= 0)` | Цена покупки |
| `estimated_value` | `NUMERIC(10,2)` | `CHECK(estimated_value >= 0)` | Текущая оценочная стоимость |
| `condition` | `VARCHAR(20)` | `NOT NULL`, `CHECK(condition IN ('excellent', 'good', 'satisfactory', 'poor'))` | Состояние экземпляра |
| `special_notes` | `TEXT` | | Особые отметки (автограф, повреждения и т.д.) |
| `is_available` | `BOOLEAN` | `DEFAULT TRUE` | Доступность для выдачи |

**Ключевые ограничения:**
- Уникальный инвентарный номер для каждого экземпляра
- Ограниченный набор значений для состояния экземпляра
- Неотрицательные значения для стоимости

#### 3.8. Таблица `user` (Пользователи)

**Назначение:** Учёт пользователей системы с различными уровнями доступа.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `user_id` | `SERIAL` | `PRIMARY KEY` | Уникальный идентификатор пользователя |
| `last_name` | `VARCHAR(50)` | `NOT NULL` | Фамилия |
| `first_name` | `VARCHAR(50)` | `NOT NULL` | Имя |
| `middle_name` | `VARCHAR(50)` | | Отчество |
| `birth_date` | `DATE` | `NOT NULL`, `CHECK(birth_date <= CURRENT_DATE)` | Дата рождения (для возрастного контроля) |
| `email` | `VARCHAR(100)` | `UNIQUE NOT NULL` | Электронная почта |
| `phone` | `VARCHAR(20)` | | Контактный телефон |
| `role` | `VARCHAR(20)` | `DEFAULT 'reader'`, `CHECK(role IN ('admin', 'librarian', 'reader'))` | Роль в системе |
| `is_active` | `BOOLEAN` | `DEFAULT TRUE` | Активен ли аккаунт |

**Роли пользователей:**
- `admin` — полный доступ ко всем функциям
- `librarian` — управление книгами и выдачами
- `reader` — только просмотр каталога и запрос на выдачу

#### 3.9. Таблица `loan` (Выдачи)

**Назначение:** Журнал учёта операций выдачи и возврата книг.

| Столбец | Тип данных | Ограничения | Описание |
|---------|------------|-------------|----------|
| `loan_id` | `SERIAL` | `PRIMARY KEY` | Уникальный идентификатор выдачи |
| `copy_id` | `INTEGER` | `NOT NULL`, `REFERENCES copy(copy_id)` | Экземпляр книги (FK) |
| `user_id` | `INTEGER` | `NOT NULL`, `REFERENCES user(user_id)` | Читатель (FK) |
| `loan_date` | `DATE` | `NOT NULL`, `DEFAULT CURRENT_DATE` | Дата выдачи |
| `due_date` | `DATE` | `NOT NULL`, `CHECK(due_date > loan_date)` | Срок возврата |
| `return_date` | `DATE` | `CHECK(return_date IS NULL OR return_date >= loan_date)` | Фактическая дата возврата |
| `age_check_paused` | `BOOLEAN` | `DEFAULT FALSE` | Флаг приостановки возрастной проверки |
| `notes` | `TEXT` | | Дополнительные примечания |

**Бизнес-правила:**
- Срок возврата должен быть позже даты выдачи
- Дата возврата не может быть раньше даты выдачи
- При `return_date IS NULL` книга считается выданной

#### Логическая структура базы данных

Логическая структура БД соответствует третьей нормальной форме (3NF), что обеспечивает:

1. **Отсутствие транзитивных зависимостей** — все неключевые атрибуты зависят только от первичного ключа.
2. **Устранение избыточности данных** — каждая сущность хранится только в одной таблице.
3. **Целостность данных** — использование внешних ключей гарантирует согласованность данных.

**Пример нормализации:**
- Информация об авторе хранится только в таблице `author`
- В таблице `book` хранится только ссылка на автора (`author_id`)
- Это предотвращает дублирование данных об авторе для каждой книги

#### Обеспечение целостности данных

Логическая структура включает следующие механизмы обеспечения целостности:

1. **Первичные ключи** — гарантируют уникальность каждой записи.
2. **Внешние ключи** — обеспечивают ссылочную целостность между таблицами.
3. **CHECK-ограничения** — проверяют значения на соответствие бизнес-правилам.
4. **UNIQUE-ограничения** — предотвращают дублирование уникальных значений.
5. **NOT NULL** — обеспечивают обязательность заполнения критических полей.

#### Преимущества разработанной логической структуры

1. **Гибкость** — позволяет легко добавлять новые книги, авторов, жанры.
2. **Масштабируемость** — структура поддерживает до 10,000 книг и 100 пользователей.
3. **Производительность** — оптимальное распределение данных по таблицам.
4. **Поддержка законодательства** — встроенная система возрастных рейтингов.
5. **Безопасность** — разделение ролей и прав доступа.


